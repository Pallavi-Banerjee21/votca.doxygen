<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Votca: moo/src/libmoo/crgunittype.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>moo/src/libmoo/crgunittype.cc</h1><a href="crgunittype_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright 2009-2011 The VOTCA Development Team (http://www.votca.org)</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Licensed under the Apache License, Version 2.0 (the "License");</span>
<a name="l00005"></a>00005 <span class="comment"> * you may not use this file except in compliance with the License.</span>
<a name="l00006"></a>00006 <span class="comment"> * You may obtain a copy of the License at</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * Unless required by applicable law or agreed to in writing, software</span>
<a name="l00011"></a>00011 <span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span>
<a name="l00012"></a>00012 <span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00013"></a>00013 <span class="comment"> * See the License for the specific language governing permissions and</span>
<a name="l00014"></a>00014 <span class="comment"> * limitations under the License.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;<a class="code" href="crgunittype_8h.html">votca/moo/crgunittype.h</a>&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">namespace </span>votca { <span class="keyword">namespace </span>moo {
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="namespacevotca_1_1moo.html#c8ab44027cc8a31aeec7a920e035a78c">00022</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacevotca_1_1moo.html#c8ab44027cc8a31aeec7a920e035a78c">get_orient</a>(<span class="keyword">const</span> <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> &amp; <a class="code" href="namespacemerge__orbitals.html#e661cff9a8b946474f1a6fb5280bd474">a</a>, <span class="keyword">const</span> <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> &amp; <a class="code" href="linsolve_8m.html#21ad0bd836b90d08f4cf640b4c298e7c">b</a>, <span class="keyword">const</span> <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> &amp; <a class="code" href="namespacemerge__orbitals.html#a3a053f698132e5705acd83e392050d5">c</a>, <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> &amp; cg) {
<a name="l00023"></a>00023 
<a name="l00024"></a>00024     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(0, 0, a.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>());
<a name="l00025"></a>00025     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(0, 1, b.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>());
<a name="l00026"></a>00026     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(0, 2, c.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>());
<a name="l00027"></a>00027     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(1, 0, a.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>());
<a name="l00028"></a>00028     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(1, 1, b.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>());
<a name="l00029"></a>00029     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(1, 2, c.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>());
<a name="l00030"></a>00030     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(2, 0, a.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>());
<a name="l00031"></a>00031     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(2, 1, b.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>());
<a name="l00032"></a>00032     cg.<a class="code" href="classvotca_1_1tools_1_1matrix.html#d99245b1d5ee64a10e62cecfac6bfbdf" title="set an element of the matrix">set</a>(2, 2, c.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>());
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#4dcc3d985949a3aa72da5bb882915627">00035</a> <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#4dcc3d985949a3aa72da5bb882915627">CrgUnitType::~CrgUnitType</a>() {
<a name="l00036"></a>00036 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>    cout &lt;&lt; <span class="stringliteral">"callgin the crgunitype destructor"</span> &lt;&lt; endl;
<a name="l00038"></a>00038 <span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>    vector &lt; vector &lt;int&gt; &gt;::iterator it_list_atoms_monomer = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>.begin();
<a name="l00040"></a>00040 <span class="comment">//    cout &lt;&lt; "start clearing the list of atom monomers" &lt;&lt;endl;</span>
<a name="l00041"></a>00041     <span class="keywordflow">for</span> (; it_list_atoms_monomer != <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>.end(); ++it_list_atoms_monomer) {
<a name="l00042"></a>00042         it_list_atoms_monomer-&gt;clear();
<a name="l00043"></a>00043     }
<a name="l00044"></a>00044   <span class="comment">//  cout &lt;&lt; "start clearing the list of  monomers" &lt;&lt;endl;</span>
<a name="l00045"></a>00045     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>.clear();
<a name="l00046"></a>00046   <span class="comment">//  cout &lt;&lt; "start clearing the list of com monomers" &lt;&lt;endl;</span>
<a name="l00047"></a>00047     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c58e15063a7af10c0f8eb27b1ae89d0c">_list_coms_monomer</a>.clear();
<a name="l00048"></a>00048   <span class="comment">//  cout &lt;&lt; "start clearing the list of ors monomers" &lt;&lt;endl;</span>
<a name="l00049"></a>00049     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#a44ad585841e750594855db6cc558f85">_list_ors_monomer</a>.clear();
<a name="l00050"></a>00050    <span class="comment">// cout &lt;&lt; "clear vector of transport orbitals" &lt;&lt;endl;</span>
<a name="l00051"></a>00051     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bfc5458e36b9c5bd792e11a4b60947ec">_transorbs</a>.clear() ;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// Added a feature - if transorbs starts with a -ve number, then all orbitals</span>
<a name="l00056"></a>00056 <span class="comment">// are kept this is important for the projection</span>
<a name="l00057"></a><a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#22a41e7b4f10d9454537770c950ab756">00057</a> <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bf370de75970dead25d4a477464c8937">CrgUnitType::CrgUnitType</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * namecoord, <span class="keyword">const</span> <span class="keywordtype">char</span> * nameorb,
<a name="l00058"></a>00058         <span class="keyword">const</span> <span class="keywordtype">char</span> * nameneutr, <span class="keyword">const</span> <span class="keywordtype">char</span> * namecrg, <span class="keywordtype">string</span> &amp; basisset,
<a name="l00059"></a>00059         <span class="keyword">const</span> vector &lt; int&gt;&amp; transorbs, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;<span class="keywordtype">id</span>,
<a name="l00060"></a>00060         <span class="keywordtype">string</span> name, vector &lt; vector &lt; int &gt; &gt; list_atoms_monomer,
<a name="l00061"></a>00061         vector &lt; vector &lt; double &gt; &gt; list_weights_monomer) {
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#541bd6b1763c80db319d92d4aa5d9a4c">_bs</a>.<a class="code" href="classvotca_1_1moo_1_1basis__set.html#90b33f8554d34d484499f65330cf78b9">set_basis_set</a>(basisset);
<a name="l00064"></a>00064     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#02aa690fb6edaea5bf7461deee6119d5">define_bs</a>(<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#541bd6b1763c80db319d92d4aa5d9a4c">_bs</a>);
<a name="l00065"></a>00065     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#68d2518bf3d922907dce67f85b24a37a">init</a>(namecoord);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="keywordflow">if</span>(strlen(nameorb) &gt;0)
<a name="l00068"></a>00068         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8e284a23629e6cf335fbfce648358c32">init_orbitals</a>(<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>, nameorb);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">if</span>(nameneutr[0] != 0 &amp;&amp; namecrg[0] != 0)
<a name="l00071"></a>00071         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#eaa3e1eaab77fa755d988a331064ac6b">init_charges</a>(nameneutr, namecrg);
<a name="l00072"></a>00072 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>    cout &lt;&lt; <span class="stringliteral">"sample of the trans: "</span> &lt;&lt; transorb &lt;&lt; <span class="stringliteral">" orbitals: "</span> &lt;&lt; (<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>.<a class="code" href="classvotca_1_1moo_1_1orb.html#a41acfa62e74c498871eb55b74195d27">getorb</a>(transorb))[4] &lt;&lt; endl;
<a name="l00074"></a>00074 <span class="preprocessor">#endif</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (transorbs.size() &gt; 0 ){
<a name="l00076"></a>00076         <span class="keywordflow">if</span>(transorbs[0] &gt;= 0)
<a name="l00077"></a>00077             <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>.<a class="code" href="classvotca_1_1moo_1_1orb.html#465a96c5690237e23abd44e6c072d1c1" title="removes all orbitals except the a_th">strip_orbitals</a>(transorbs);
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>    cout &lt;&lt; <span class="stringliteral">"sample of the stripped orbitals: "</span> &lt;&lt; (<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>.<a class="code" href="classvotca_1_1moo_1_1orb.html#a41acfa62e74c498871eb55b74195d27">getorb</a>(0))[4] &lt;&lt; endl;
<a name="l00082"></a>00082 <span class="preprocessor">#endif</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>    <span class="comment">// _transorb = 0;</span>
<a name="l00084"></a>00084     <span class="keywordtype">int</span> limit = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>.<a class="code" href="classvotca_1_1moo_1_1orb.html#2d6100d323cb1787406fa3de4cf8dffe">getNBasis</a>();
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (transorbs.size() &gt; 0 ) {
<a name="l00086"></a>00086       <span class="keywordflow">if</span> (transorbs[0] &gt;= 0 ) {
<a name="l00087"></a>00087         limit = transorbs.size();
<a name="l00088"></a>00088      }
<a name="l00089"></a>00089     } <span class="keywordflow">else</span> {
<a name="l00090"></a>00090         limit = 0;
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>=0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>&lt;limit; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++){
<a name="l00095"></a>00095         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bfc5458e36b9c5bd792e11a4b60947ec">_transorbs</a>.push_back(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#9b2b87e67a004ebfaad1f5b59d62a589">_id</a> = id;
<a name="l00098"></a>00098     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#699c6a4fedced8a6a851ac8d86688eff" title="the name of this transport unit">_name</a> = name;
<a name="l00099"></a>00099     vector &lt; vector &lt; int &gt; &gt; ::iterator it_mon;
<a name="l00100"></a>00100     vector &lt; vector &lt; double &gt; &gt; ::iterator it_mon_weights;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (list_atoms_monomer.size() != list_weights_monomer.size())
<a name="l00103"></a>00103         <span class="keywordflow">throw</span> invalid_argument(<span class="stringliteral">"number of atoms and weights do not match for charge unit &lt;"</span> + name + <span class="stringliteral">"&gt;"</span>);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordtype">int</span> count = 0;
<a name="l00106"></a>00106     <span class="keywordflow">for</span> (it_mon = list_atoms_monomer.begin(), it_mon_weights = list_weights_monomer.begin();
<a name="l00107"></a>00107             it_mon &lt; list_atoms_monomer.end(); ++it_mon, ++it_mon_weights) {
<a name="l00108"></a>00108         vector &lt;int&gt; list_mon;
<a name="l00109"></a>00109         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>.push_back(list_mon);
<a name="l00110"></a>00110         vector &lt;int&gt; ::iterator it_at;
<a name="l00111"></a>00111         vector &lt;double&gt; ::iterator it_weight;
<a name="l00112"></a>00112         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> com(0., 0., 0.);
<a name="l00113"></a>00113         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> <a class="code" href="namespacevotca_1_1moo.html#6a44f6663e516c56327f0baf6560f39d522b856dcae786b6fd48bd5e2d802f5f">m</a>(0.);
<a name="l00114"></a>00114         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> orient;
<a name="l00115"></a>00115         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> xprime, yprime, zprime;
<a name="l00116"></a>00116         <span class="keywordflow">if</span> (it_mon-&gt;size() != it_mon_weights-&gt;size())
<a name="l00117"></a>00117             <span class="keywordflow">throw</span> invalid_argument(<span class="stringliteral">"number of atoms and weights do not match for charge unit &lt;"</span> + name + <span class="stringliteral">"&gt;"</span>);
<a name="l00118"></a>00118         <span class="keywordtype">double</span> sum_weights = 0;
<a name="l00119"></a>00119         <span class="keywordflow">for</span> (it_at = it_mon-&gt;begin(), it_weight = it_mon_weights-&gt;begin();
<a name="l00120"></a>00120                 it_at != it_mon-&gt;end(); ++it_at, ++it_weight) {
<a name="l00121"></a>00121             com = com + <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8a29c64fef70c808db7da319c0db2ff2">GetPos</a>(*it_at)*(*it_weight);
<a name="l00122"></a>00122             (<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>[count]).push_back(*it_at);
<a name="l00123"></a>00123             sum_weights += *it_weight;
<a name="l00124"></a>00124         }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         com /= sum_weights;
<a name="l00127"></a>00127         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c58e15063a7af10c0f8eb27b1ae89d0c">_list_coms_monomer</a>.push_back(com);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (it_mon-&gt; size() &gt; 3) {
<a name="l00130"></a>00130             <span class="keywordflow">for</span> (it_at = it_mon-&gt;begin(), it_weight = it_mon_weights-&gt;begin();
<a name="l00131"></a>00131                     it_at != it_mon-&gt;end(); ++it_at, ++it_weight) {
<a name="l00132"></a>00132                 <span class="keywordflow">if</span> (*it_weight == 0) <span class="keywordflow">continue</span>;
<a name="l00133"></a>00133                 <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> v = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8a29c64fef70c808db7da319c0db2ff2">GetPos</a>(*it_at) - com;
<a name="l00134"></a>00134 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>                cout &lt;&lt; <span class="stringliteral">"Adding atom "</span> &lt;&lt; *it_at &lt;&lt; <span class="stringliteral">" to monomer "</span> &lt;&lt; count &lt;&lt; endl;
<a name="l00136"></a>00136 <span class="preprocessor">#endif</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>                m[0][0] +=  v.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>() * v.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>();
<a name="l00138"></a>00138                 m[0][1] +=  v.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>() * v.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>();
<a name="l00139"></a>00139                 m[0][2] +=  v.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>() * v.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>();
<a name="l00140"></a>00140                 m[1][1] +=  v.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>() * v.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>();
<a name="l00141"></a>00141                 m[1][2] +=  v.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>() * v.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>();
<a name="l00142"></a>00142                 m[2][2] +=  v.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>() * v.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>();
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145             m[1][0] = m[0][1];
<a name="l00146"></a>00146             m[2][0] = m[0][2];
<a name="l00147"></a>00147             m[2][1] = m[1][2];
<a name="l00148"></a>00148 
<a name="l00149"></a>00149             <a class="code" href="structvotca_1_1tools_1_1matrix_1_1eigensystem__t.html">matrix::eigensystem_t</a> es;
<a name="l00150"></a>00150             m.<a class="code" href="classvotca_1_1tools_1_1matrix.html#b10ef500423e48c064725504cc9a3009" title="calculate eigenvalues and eigenvectors">SolveEigensystem</a>(es);
<a name="l00151"></a>00151             zprime = es.<a class="code" href="structvotca_1_1tools_1_1matrix_1_1eigensystem__t.html#59d8c983bbd2effe6c66e52b3a5cf623">eigenvecs</a>[0];
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a>00154             xprime = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8a29c64fef70c808db7da319c0db2ff2">GetPos</a>((list_atoms_monomer[count])[1]) - <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8a29c64fef70c808db7da319c0db2ff2">GetPos</a>((list_atoms_monomer[count])[0]);
<a name="l00155"></a>00155             xprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>(); <span class="comment">//these 2 lines useless</span>
<a name="l00156"></a>00156             zprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00157"></a>00157 <span class="preprocessor">#ifdef DEBUG </span>
<a name="l00158"></a>00158 <span class="preprocessor"></span>            cout &lt;&lt; <span class="stringliteral">"xaxis : "</span> &lt;&lt; xprime &lt;&lt; endl;
<a name="l00159"></a>00159 <span class="preprocessor">#endif</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>            <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> w = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8a29c64fef70c808db7da319c0db2ff2">GetPos</a>((list_atoms_monomer[count])[2]) - <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8a29c64fef70c808db7da319c0db2ff2">GetPos</a>((list_atoms_monomer[count])[0]);
<a name="l00161"></a>00161             w.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00162"></a>00162 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>            cout &lt;&lt; <span class="stringliteral">"CN bond: "</span> &lt;&lt; w &lt;&lt; endl;
<a name="l00164"></a>00164 <span class="preprocessor">#endif</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ((xprime^w) * zprime &lt; 0) {
<a name="l00166"></a>00166                 zprime = <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a>(0., 0., 0.) - zprime;
<a name="l00167"></a>00167 <span class="preprocessor">#ifdef DEBUB</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>                cout &lt;&lt; <span class="stringliteral">"flipping the zaxis"</span> &lt;&lt; endl;
<a name="l00169"></a>00169 <span class="preprocessor">#endif</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>            }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172             <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> yprime = (zprime) ^ (xprime);
<a name="l00173"></a>00173             xprime = yprime ^ (zprime);
<a name="l00174"></a>00174             xprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00175"></a>00175             yprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00176"></a>00176             zprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179             <a class="code" href="namespacevotca_1_1moo.html#c8ab44027cc8a31aeec7a920e035a78c">get_orient</a>(xprime, yprime, zprime, orient);
<a name="l00180"></a>00180             orient.<a class="code" href="classvotca_1_1tools_1_1matrix.html#bd0154dac1004c73b36a9ed73df401ba" title="transpose the matrix">Transpose</a>();
<a name="l00181"></a>00181         } <span class="keywordflow">else</span> {
<a name="l00182"></a>00182             orient.<a class="code" href="classvotca_1_1tools_1_1matrix.html#f8e383e8c3d9229d0c9958b6cd6ec9e6" title="initialize the matrix as identity">UnitMatrix</a>();
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#a44ad585841e750594855db6cc558f85">_list_ors_monomer</a>.push_back(orient);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="preprocessor">#ifdef DEBUG </span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">"Making charge unit of type: "</span> &lt;&lt; <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#9b2b87e67a004ebfaad1f5b59d62a589">_id</a> &lt;&lt; <span class="stringliteral">" initing monomer "</span> &lt;&lt; count &lt;&lt; <span class="stringliteral">" with normal "</span>
<a name="l00188"></a>00188                 &lt;&lt; zprime &lt;&lt; <span class="stringliteral">" and plane: "</span> &lt;&lt; xprime &lt;&lt; endl;
<a name="l00189"></a>00189 <span class="preprocessor">#endif</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>        count++;
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#fffcd1f986810db594f8a6f26d39ac63" title="makes a list of start orbital on an atom and number if basis sets on that atom">assign_orb</a>(&amp;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>);
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#fa5e33aae1a8080a4b73fc92642d7b52">00199</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#fa5e33aae1a8080a4b73fc92642d7b52">CrgUnitType::rotate_each_bead</a>(vector &lt; vec &gt;::iterator it_pos, vector &lt; vec &gt;::iterator it_norm,
<a name="l00200"></a>00200         vector &lt;vec &gt;::iterator it_plan, <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">mol_and_orb</a> * rotated_molecule) {
<a name="l00201"></a>00201     vector &lt; vector &lt;int&gt; &gt;::iterator it_monomers;
<a name="l00202"></a>00202     vector &lt; vec &gt;::iterator it_coms = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c58e15063a7af10c0f8eb27b1ae89d0c">_list_coms_monomer</a>.begin();
<a name="l00203"></a>00203     vector &lt;matrix&gt;::iterator it_ors = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#a44ad585841e750594855db6cc558f85">_list_ors_monomer</a>.begin();
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keywordtype">int</span> count = 0;
<a name="l00206"></a>00206     <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> old_norm;
<a name="l00207"></a>00207     <span class="keywordflow">for</span> (it_monomers = <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>.begin(); it_monomers != <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#5165e8537dc60cb9b525902ce733edd1">_list_atoms_monomer</a>.end();
<a name="l00208"></a>00208             ++it_monomers, ++it_pos, ++it_norm, ++it_plan, ++it_coms, ++it_ors) {
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         
<a name="l00211"></a>00211         <span class="comment">// we need to define the rotation matrix for the beads</span>
<a name="l00212"></a>00212         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> zprime = (*it_norm);
<a name="l00213"></a>00213         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> yprime = zprime ^ (*it_plan);
<a name="l00214"></a>00214         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> xprime = yprime ^ (zprime);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         xprime = xprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00217"></a>00217 <span class="preprocessor">#ifdef DEBUG </span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="namespacevotca_1_1tools.html#bc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(yprime) &lt; 1E-6) {
<a name="l00219"></a>00219             cout &lt;&lt; <span class="stringliteral">"Errorm the inplane vector is parallel to the nomal one!"</span> &lt;&lt; endl;
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221 <span class="preprocessor">#endif</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>        yprime = yprime.<a class="code" href="classvotca_1_1tools_1_1vec.html#3e64d858494103178d0fdb984d369251" title="normalize the vector">normalize</a>();
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> zprime_orb = zprime;
<a name="l00225"></a>00225         <span class="keywordflow">if</span> (count &gt; 0) {
<a name="l00226"></a>00226             <span class="comment">// check if the orbitals need "flipping"</span>
<a name="l00227"></a>00227             <span class="keywordflow">if</span> (old_norm * (zprime) &gt; 0.) zprime_orb = <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a>(0., 0., 0.) - zprime;
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> orient_pos;
<a name="l00231"></a>00231         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> orient_orb;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         <a class="code" href="namespacevotca_1_1moo.html#c8ab44027cc8a31aeec7a920e035a78c">get_orient</a>(xprime, yprime, zprime, orient_pos);
<a name="l00234"></a>00234         <a class="code" href="namespacevotca_1_1moo.html#c8ab44027cc8a31aeec7a920e035a78c">get_orient</a>(xprime, yprime, zprime_orb, orient_orb);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> Orient_Pos = orient_pos * (*it_ors);
<a name="l00237"></a>00237         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> Orient_Orb = orient_orb * (*it_ors);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">"NUMBER OF atoms in the the monemer: "</span> &lt;&lt; it_monomers-&gt;size() &lt;&lt; <span class="stringliteral">"displacement"</span> &lt;&lt; *it_pos &lt;&lt;
<a name="l00241"></a>00241                 <span class="stringliteral">" internal cebtre of nassL "</span> &lt;&lt; *it_coms &lt;&lt; endl;
<a name="l00242"></a>00242         cout &lt;&lt; <span class="stringliteral">" type of crgunittype: "</span> &lt;&lt; <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#9b2b87e67a004ebfaad1f5b59d62a589">_id</a> &lt;&lt; endl;
<a name="l00243"></a>00243         cout &lt;&lt; <span class="stringliteral">"normal vector: "</span> &lt;&lt; zprime &lt;&lt; <span class="stringliteral">" and for orbitals: "</span> &lt;&lt; zprime_orb &lt;&lt; <span class="stringliteral">" and plane vector: "</span> &lt;&lt; xprime &lt;&lt; endl;
<a name="l00244"></a>00244 <span class="preprocessor">#endif</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>
<a name="l00254"></a>00254         <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#28a9db4f4eb2190c5c8bae48603de0e8">_intcoords</a>.<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#2f69f6b1f5f12ce101acf96cb1913270">rotate_someatoms</a>(*it_monomers, Orient_Pos, *it_pos, *it_coms, rotated_molecule);
<a name="l00255"></a>00255         <span class="comment">// rotating all orbitals now (hopefully)</span>
<a name="l00256"></a>00256         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>=0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>&lt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bfc5458e36b9c5bd792e11a4b60947ec">_transorbs</a>.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++){
<a name="l00257"></a>00257             <a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#bc12f970d0fc5224916aeed8a1ccfd9f">_orbitals</a>.<a class="code" href="classvotca_1_1moo_1_1orb.html#97536f480deb055d42f8cbde2e389c16">rotate_someatoms</a>(*it_monomers, &amp;Orient_Orb, rotated_molecule-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#e3a21fdf969ad77d2c88adb746227321">getorb</a>(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>), <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259         old_norm = zprime;
<a name="l00260"></a>00260         count++;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 }}
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
