<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Votca: ctp/src/libctp/calculators/izindo.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ctp/src/libctp/calculators/izindo.h</h1><a href="izindo_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *            Copyright 2009-2012 The VOTCA Development Team</span>
<a name="l00003"></a>00003 <span class="comment"> *                       (http://www.votca.org)</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *      Licensed under the Apache License, Version 2.0 (the "License")</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * You may not use this file except in compliance with the License.</span>
<a name="l00008"></a>00008 <span class="comment"> * You may obtain a copy of the License at</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *              http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * Unless required by applicable law or agreed to in writing, software</span>
<a name="l00013"></a>00013 <span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span>
<a name="l00014"></a>00014 <span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00015"></a>00015 <span class="comment"> * See the License for the specific language governing permissions and</span>
<a name="l00016"></a>00016 <span class="comment"> * limitations under the License.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#ifndef _CALC_INTEGRALS_H</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#define _CALC_INTEGRALS_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="qmpair_8h.html">votca/ctp/qmpair.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="paircalculator_8h.html">votca/ctp/paircalculator.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="mol__and__orb_8h.html">votca/moo/mol_and_orb.h</a>&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">namespace </span>votca { <span class="keyword">namespace </span>ctp {
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">namespace </span>MOO = votca::moo;
<a name="l00031"></a>00031 
<a name="l00042"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html">00042</a> <span class="keyword">class </span><a class="code" href="classvotca_1_1ctp_1_1IZindo.html" title="Semi-empirical electronic coupling elements for QM pairs.">IZindo</a> : <span class="keyword">public</span> <a class="code" href="classvotca_1_1ctp_1_1ParallelPairCalculator.html">ParallelPairCalculator</a>
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044 <span class="keyword">public</span>:
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#c75997d84c8be6398aab46bc70a4649e">00046</a>     <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#c75997d84c8be6398aab46bc70a4649e">IZindo</a>() {};
<a name="l00047"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#f77730e8c264bcc4b4b26c7c0450e968">00047</a>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#f77730e8c264bcc4b4b26c7c0450e968">~IZindo</a>() {};
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#060abfe0792c7940ef5b7158973958f4">00049</a>     <span class="keywordtype">string</span>  <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#060abfe0792c7940ef5b7158973958f4">Identify</a>() { <span class="keywordflow">return</span> <span class="stringliteral">"IZindo"</span>; }
<a name="l00050"></a>00050     <span class="keywordtype">void</span>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7bb41595b4c3fe30d25a4ecf5e2ffce9">Initialize</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *<a class="code" href="namespacedensity__symmetrize.html#b03e9a2229b129b862f9b831e961b35e">options</a>);
<a name="l00051"></a>00051     <span class="keywordtype">void</span>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#28d2bb892a9756cf7856dc0284c37fea">ParseOrbitalsXML</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *<a class="code" href="namespacedensity__symmetrize.html#b03e9a2229b129b862f9b831e961b35e">options</a>);
<a name="l00052"></a>00052     <span class="keywordtype">void</span>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#8a778b809601aea3e96b1560d9dcc96a">EvalPair</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair, <span class="keywordtype">int</span> slot);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="keywordtype">void</span>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e103987cd55511b016c3848e3b62feed">CTP2MOO2CTP</a>(<a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair, <span class="keywordtype">int</span> slot, <span class="keywordtype">int</span> state);
<a name="l00055"></a>00055     <span class="keywordtype">void</span>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#029231cee7d7e27d9c34c7b9bf196119">CalculateJ</a>(<a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair);
<a name="l00056"></a>00056     <span class="keywordtype">void</span>    <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#b03e10670aeddfb0e4333b7761ecfb98">CleanUp</a>();
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="keyword">private</span>:
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7798cac2cebbaa681dcbc9e04ac1a86a">00061</a>     <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">MOO::mol_and_orb</a> *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7798cac2cebbaa681dcbc9e04ac1a86a">_morb1</a>;
<a name="l00062"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a1d8296aa208f5eb6944165876ad9b4f">00062</a>     <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">MOO::mol_and_orb</a> *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a1d8296aa208f5eb6944165876ad9b4f">_morb2</a>;
<a name="l00063"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#165dba0333e2089978aefc64f1fad5dc">00063</a>     <a class="code" href="classvotca_1_1moo_1_1basis__set.html">MOO::basis_set</a>   *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#165dba0333e2089978aefc64f1fad5dc">_basis1</a>;
<a name="l00064"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#fd63b4c2d12880ae1f6acf789151ed58">00064</a>     <a class="code" href="classvotca_1_1moo_1_1basis__set.html">MOO::basis_set</a>   *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#fd63b4c2d12880ae1f6acf789151ed58">_basis2</a>;
<a name="l00065"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#890e407e209b2bf8d22c215b484f9ce6">00065</a>     <a class="code" href="classvotca_1_1moo_1_1orb.html">MOO::orb</a>         *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#890e407e209b2bf8d22c215b484f9ce6">_orb1</a>;
<a name="l00066"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e545cae3ac9f0651d9cf633717ea3091">00066</a>     <a class="code" href="classvotca_1_1moo_1_1orb.html">MOO::orb</a>         *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e545cae3ac9f0651d9cf633717ea3091">_orb2</a>;
<a name="l00067"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ec2250bbca8ce8e26ecbabcab3dc9908">00067</a>     <a class="code" href="classvotca_1_1moo_1_1fock.html" title="this class will contain the fock matrix and pointers to the molecules involved in...">MOO::fock</a>        *<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ec2250bbca8ce8e26ecbabcab3dc9908">_fock</a>;
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#082eb79ae2ac22cb72cd0b8ebcb10a61">00069</a>     vector&lt;int&gt; <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#082eb79ae2ac22cb72cd0b8ebcb10a61">_torbNrs1</a>;
<a name="l00070"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#714093b75041e4eb04787dc3bfe75377">00070</a>     vector&lt;int&gt; <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#714093b75041e4eb04787dc3bfe75377">_torbNrs2</a>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">// Fock::CalcJ(...) apparently uses</span>
<a name="l00073"></a>00073     <span class="comment">// thread-unsafe containers and / or</span>
<a name="l00074"></a>00074     <span class="comment">// (hidden) malloc()s. Restrict...</span>
<a name="l00075"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#89ffd2455d83fc70c39fa15781b3d2a6">00075</a>     <a class="code" href="classvotca_1_1tools_1_1Mutex.html" title="Convenient class for Mutexes.">Mutex</a>       <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#89ffd2455d83fc70c39fa15781b3d2a6">_FockPath</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="comment">// Information on orbitals for segments</span>
<a name="l00079"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#53fbe446915d91b14eb7ba978caa1250">00079</a>     map&lt;string,string&gt;          <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#53fbe446915d91b14eb7ba978caa1250">_seg_basisName</a>;
<a name="l00080"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ac958ede00600b1671ac296b2f850a1b">00080</a>     map&lt;string,string&gt;          <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ac958ede00600b1671ac296b2f850a1b">_seg_orbFile</a>;
<a name="l00081"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#9445366ec71e55a7597664d4c247f98f">00081</a>     map&lt;string,bool&gt;            <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#9445366ec71e55a7597664d4c247f98f">_seg_has_e</a>;
<a name="l00082"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a128ebbe839b5e636e355a5e1f64f5f2">00082</a>     map&lt;string,bool&gt;            <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a128ebbe839b5e636e355a5e1f64f5f2">_seg_has_h</a>;
<a name="l00083"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#cf6fb1fbba0f2aac9e7b7307de5c8d7b">00083</a>     map&lt; string, vector&lt;int&gt; &gt;  <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#cf6fb1fbba0f2aac9e7b7307de5c8d7b">_seg_torbs_e</a>;
<a name="l00084"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#6efdf54045117d44789484c3286ef4ca">00084</a>     map&lt; string, vector&lt;int&gt; &gt;  <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#6efdf54045117d44789484c3286ef4ca">_seg_torbs_h</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 };
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#b03e10670aeddfb0e4333b7761ecfb98">00088</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#b03e10670aeddfb0e4333b7761ecfb98">IZindo::CleanUp</a>() {
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7798cac2cebbaa681dcbc9e04ac1a86a">_morb1</a>;
<a name="l00091"></a>00091     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a1d8296aa208f5eb6944165876ad9b4f">_morb2</a>;
<a name="l00092"></a>00092     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#165dba0333e2089978aefc64f1fad5dc">_basis1</a>;
<a name="l00093"></a>00093     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#fd63b4c2d12880ae1f6acf789151ed58">_basis2</a>;
<a name="l00094"></a>00094     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#890e407e209b2bf8d22c215b484f9ce6">_orb1</a>;
<a name="l00095"></a>00095     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e545cae3ac9f0651d9cf633717ea3091">_orb2</a>;
<a name="l00096"></a>00096     <span class="keyword">delete</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ec2250bbca8ce8e26ecbabcab3dc9908">_fock</a>;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#082eb79ae2ac22cb72cd0b8ebcb10a61">_torbNrs1</a>.clear();
<a name="l00099"></a>00099     <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#714093b75041e4eb04787dc3bfe75377">_torbNrs2</a>.clear();
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7bb41595b4c3fe30d25a4ecf5e2ffce9">00103</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7bb41595b4c3fe30d25a4ecf5e2ffce9">IZindo::Initialize</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *<a class="code" href="namespacedensity__symmetrize.html#b03e9a2229b129b862f9b831e961b35e">options</a>) {
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"... ... Initialize with "</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1QMCalculator.html#02a47c6b33b0431899fa70910fb53842">_nThreads</a> &lt;&lt; <span class="stringliteral">" threads."</span>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="comment">/* ---- OPTIONS.XML Structure -----</span>
<a name="l00108"></a>00108 <span class="comment">     *</span>
<a name="l00109"></a>00109 <span class="comment">     * &lt;izindo&gt;</span>
<a name="l00110"></a>00110 <span class="comment">     *</span>
<a name="l00111"></a>00111 <span class="comment">     *      &lt;orbitalsXML&gt;ORBITALS.XML&lt;/orbitalsXML&gt;</span>
<a name="l00112"></a>00112 <span class="comment">     *</span>
<a name="l00113"></a>00113 <span class="comment">     * &lt;/izindo&gt;</span>
<a name="l00114"></a>00114 <span class="comment">     *</span>
<a name="l00115"></a>00115 <span class="comment">     */</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     this-&gt;<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#28d2bb892a9756cf7856dc0284c37fea">ParseOrbitalsXML</a>(top, options);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#28d2bb892a9756cf7856dc0284c37fea">00122</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#28d2bb892a9756cf7856dc0284c37fea">IZindo::ParseOrbitalsXML</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *opt) {
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="keywordtype">string</span> key = <span class="stringliteral">"options.izindo"</span>;
<a name="l00125"></a>00125     <span class="keywordtype">string</span> orbitalsXML = opt-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(key+<span class="stringliteral">".orbitalsXML"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span>&gt; ();
<a name="l00126"></a>00126     cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"... ... Orbital data from "</span> &lt;&lt; orbitalsXML &lt;&lt; <span class="stringliteral">". "</span>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> alloc;
<a name="l00129"></a>00129     <a class="code" href="namespacevotca_1_1tools.html#f135f0aaaac442ad3d3285a3b1d539b7">load_property_from_xml</a>(alloc, orbitalsXML.c_str());    
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">/* --- ORBITALS.XML Structure ---</span>
<a name="l00132"></a>00132 <span class="comment">     *</span>
<a name="l00133"></a>00133 <span class="comment">     * &lt;topology&gt;</span>
<a name="l00134"></a>00134 <span class="comment">     *</span>
<a name="l00135"></a>00135 <span class="comment">     *     &lt;molecules&gt;</span>
<a name="l00136"></a>00136 <span class="comment">     *          &lt;molecule&gt;</span>
<a name="l00137"></a>00137 <span class="comment">     *          &lt;name&gt;&lt;/name&gt;</span>
<a name="l00138"></a>00138 <span class="comment">     *</span>
<a name="l00139"></a>00139 <span class="comment">     *          &lt;segments&gt;</span>
<a name="l00140"></a>00140 <span class="comment">     *</span>
<a name="l00141"></a>00141 <span class="comment">     *              &lt;segment&gt;</span>
<a name="l00142"></a>00142 <span class="comment">     *              &lt;name&gt;&lt;/name&gt;</span>
<a name="l00143"></a>00143 <span class="comment">     *</span>
<a name="l00144"></a>00144 <span class="comment">     *              &lt;basisset&gt;&lt;/basisset&gt;</span>
<a name="l00145"></a>00145 <span class="comment">     *              &lt;orbitals&gt;&lt;/orbitals&gt;</span>
<a name="l00146"></a>00146 <span class="comment">     *</span>
<a name="l00147"></a>00147 <span class="comment">     *              &lt;torbital_e&gt;&lt;/torbital_e&gt;</span>
<a name="l00148"></a>00148 <span class="comment">     *              &lt;torbital_h&gt;&lt;/torbital_h&gt;</span>
<a name="l00149"></a>00149 <span class="comment">     *              &lt;/segment&gt;</span>
<a name="l00150"></a>00150 <span class="comment">     *</span>
<a name="l00151"></a>00151 <span class="comment">     *              &lt;segment&gt;</span>
<a name="l00152"></a>00152 <span class="comment">     *                  ...</span>
<a name="l00153"></a>00153 <span class="comment">     *</span>
<a name="l00154"></a>00154 <span class="comment">     */</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     key = <span class="stringliteral">"topology.molecules.molecule"</span>;
<a name="l00157"></a>00157     list&lt;Property*&gt; mols = alloc.<a class="code" href="classvotca_1_1tools_1_1Property.html#d7987d4a19543a46ca8d38dd8b26121a" title="select property based on a filter">Select</a>(key);
<a name="l00158"></a>00158     list&lt;Property*&gt; ::iterator molit;
<a name="l00159"></a>00159     <span class="keywordflow">for</span> (molit = mols.begin(); molit != mols.end(); ++molit) {
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         key = <span class="stringliteral">"segments.segment"</span>;
<a name="l00162"></a>00162         list&lt;Property*&gt; segs = (*molit)-&gt;Select(key);
<a name="l00163"></a>00163         list&lt;Property*&gt; ::iterator segit;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keywordflow">for</span> (segit = segs.begin(); segit != segs.end(); ++segit) {
<a name="l00166"></a>00166 
<a name="l00167"></a>00167             <span class="keywordtype">string</span> segName = (*segit)-&gt;get(<span class="stringliteral">"name"</span>).as&lt;<span class="keywordtype">string</span>&gt; ();
<a name="l00168"></a>00168             <span class="keywordtype">string</span> basisName = (*segit)-&gt;get(<span class="stringliteral">"basisset"</span>).as&lt;<span class="keywordtype">string</span>&gt; ();
<a name="l00169"></a>00169             <span class="keywordtype">string</span> orbFile = (*segit)-&gt;get(<span class="stringliteral">"orbitals"</span>).as&lt;<span class="keywordtype">string</span>&gt; ();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171             <span class="keywordtype">bool</span> has_e = <span class="keyword">false</span>;
<a name="l00172"></a>00172             <span class="keywordtype">bool</span> has_h = <span class="keyword">false</span>;
<a name="l00173"></a>00173             vector&lt;int&gt; torbs_e;
<a name="l00174"></a>00174             vector&lt;int&gt; torbs_h;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176             <span class="keywordflow">if</span> ( (*segit)-&gt;exists(<span class="stringliteral">"torbital_e"</span>) ) {
<a name="l00177"></a>00177                 torbs_e = (*segit)-&gt;get(<span class="stringliteral">"torbital_e"</span>).as&lt; vector&lt;int&gt; &gt; ();
<a name="l00178"></a>00178                 has_e = (torbs_e.size()) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180             <span class="keywordflow">if</span> ( (*segit)-&gt;exists(<span class="stringliteral">"torbital_h"</span>) ) {
<a name="l00181"></a>00181                 torbs_h = (*segit)-&gt;get(<span class="stringliteral">"torbital_h"</span>).as&lt; vector&lt;int&gt; &gt; ();
<a name="l00182"></a>00182                 has_h = (torbs_h.size()) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#53fbe446915d91b14eb7ba978caa1250">_seg_basisName</a>[segName] = basisName;
<a name="l00186"></a>00186             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ac958ede00600b1671ac296b2f850a1b">_seg_orbFile</a>[segName] = orbFile;
<a name="l00187"></a>00187             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#9445366ec71e55a7597664d4c247f98f">_seg_has_e</a>[segName] = has_e;
<a name="l00188"></a>00188             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a128ebbe839b5e636e355a5e1f64f5f2">_seg_has_h</a>[segName] = has_h;
<a name="l00189"></a>00189             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#cf6fb1fbba0f2aac9e7b7307de5c8d7b">_seg_torbs_e</a>[segName] = torbs_e;
<a name="l00190"></a>00190             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#6efdf54045117d44789484c3286ef4ca">_seg_torbs_h</a>[segName] = torbs_h;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#8a778b809601aea3e96b1560d9dcc96a">00197</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#8a778b809601aea3e96b1560d9dcc96a">IZindo::EvalPair</a>(<a class="code" href="classvotca_1_1ctp_1_1Topology.html" title="Container for molecules, conjugated segments, rigid fragments, and atoms.">Topology</a> *top, <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *qmpair, <span class="keywordtype">int</span> slot) {
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     this-&gt;<a class="code" href="classvotca_1_1ctp_1_1ParallelPairCalculator.html#40887632f330e6442a6a26718c0a9233">LockCout</a>();
<a name="l00200"></a>00200     cout &lt;&lt; <span class="stringliteral">"\r... ... Evaluating pair "</span> &lt;&lt; qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#24b39a974865abbf243b3a86a86601a2">getId</a>()+1 &lt;&lt; flush;
<a name="l00201"></a>00201     this-&gt;<a class="code" href="classvotca_1_1ctp_1_1ParallelPairCalculator.html#058b21196d1c205cc9fe114292585ac5">UnlockCout</a>();
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordtype">string</span> segName1 = qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#e3bbc86e96fd3c81901f43a4407796ea">Seg1</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f5a55c31af0b42d2da34ea68c833a8bd">getName</a>();
<a name="l00204"></a>00204     <span class="keywordtype">string</span> segName2 = qmpair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#c57db6f8041b0af246516de6b32f6c89">Seg2</a>()-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#f5a55c31af0b42d2da34ea68c833a8bd">getName</a>();
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keywordtype">bool</span> pair_has_e = <span class="keyword">false</span>;
<a name="l00207"></a>00207     <span class="keywordtype">bool</span> pair_has_h = <span class="keyword">false</span>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="keywordflow">try</span> {
<a name="l00210"></a>00210         pair_has_e = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#9445366ec71e55a7597664d4c247f98f">_seg_has_e</a>.at(segName1) &amp;&amp; <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#9445366ec71e55a7597664d4c247f98f">_seg_has_e</a>.at(segName2);
<a name="l00211"></a>00211         pair_has_h = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a128ebbe839b5e636e355a5e1f64f5f2">_seg_has_h</a>.at(segName1) &amp;&amp; <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a128ebbe839b5e636e355a5e1f64f5f2">_seg_has_h</a>.at(segName2);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     <span class="keywordflow">catch</span> (out_of_range) {
<a name="l00214"></a>00214         this-&gt;<a class="code" href="classvotca_1_1ctp_1_1ParallelPairCalculator.html#40887632f330e6442a6a26718c0a9233">LockCout</a>();
<a name="l00215"></a>00215         cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"... ... WARNING: No orbital information for pair ["</span>
<a name="l00216"></a>00216                      &lt;&lt; segName1 &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; segName2 &lt;&lt; <span class="stringliteral">"]. "</span>
<a name="l00217"></a>00217                      &lt;&lt; <span class="stringliteral">"Skipping... "</span> &lt;&lt; endl;
<a name="l00218"></a>00218         this-&gt;<a class="code" href="classvotca_1_1ctp_1_1ParallelPairCalculator.html#058b21196d1c205cc9fe114292585ac5">UnlockCout</a>();
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="keywordflow">return</span>;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (pair_has_e) {
<a name="l00224"></a>00224         this-&gt;<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e103987cd55511b016c3848e3b62feed">CTP2MOO2CTP</a>(qmpair, slot, -1);
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (pair_has_h) {
<a name="l00227"></a>00227         this-&gt;<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e103987cd55511b016c3848e3b62feed">CTP2MOO2CTP</a>(qmpair, slot, +1);
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e103987cd55511b016c3848e3b62feed">00233</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e103987cd55511b016c3848e3b62feed">IZindo::CTP2MOO2CTP</a>(<a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair, <span class="keywordtype">int</span> slot, <span class="keywordtype">int</span> state) {
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     <span class="comment">// ++++++++++++++++++++++ //</span>
<a name="l00236"></a>00236     <span class="comment">// Initialize MOO Objects //</span>
<a name="l00237"></a>00237     <span class="comment">// ++++++++++++++++++++++ //</span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <a class="code" href="classvotca_1_1ctp_1_1Segment.html">Segment</a> *seg1 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#b6f64a9a1299f322aa4c76ac39815327">Seg1PbCopy</a>();
<a name="l00240"></a>00240     <a class="code" href="classvotca_1_1ctp_1_1Segment.html">Segment</a> *seg2 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#8fd5eaaa0814e027e29a39bdf962469d">Seg2PbCopy</a>();
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">SegmentType</a> *type2 = seg2-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#242835d4f11b859eaee13f8d9f19da72">getType</a>();
<a name="l00243"></a>00243     <a class="code" href="classvotca_1_1ctp_1_1SegmentType.html">SegmentType</a> *type1 = seg1-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#242835d4f11b859eaee13f8d9f19da72">getType</a>();
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     <span class="keywordtype">string</span> coordsFile1 = type1-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#cc8fee46b7cafd9619f23e41e30397a7">getQMCoordsFile</a>();
<a name="l00246"></a>00246     <span class="keywordtype">string</span> coordsFile2 = type2-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#cc8fee46b7cafd9619f23e41e30397a7">getQMCoordsFile</a>();
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordtype">string</span> basisName1;
<a name="l00249"></a>00249     <span class="keywordtype">string</span> basisName2;
<a name="l00250"></a>00250     <span class="keywordtype">string</span> orbFile1;
<a name="l00251"></a>00251     <span class="keywordtype">string</span> orbFile2;
<a name="l00252"></a>00252     vector&lt;int&gt; torbs1;
<a name="l00253"></a>00253     vector&lt;int&gt; torbs2;
<a name="l00254"></a>00254         
<a name="l00255"></a>00255     basisName1 = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#53fbe446915d91b14eb7ba978caa1250">_seg_basisName</a>.at(type1-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>());
<a name="l00256"></a>00256     basisName2 = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#53fbe446915d91b14eb7ba978caa1250">_seg_basisName</a>.at(type2-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>());
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     orbFile1 = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ac958ede00600b1671ac296b2f850a1b">_seg_orbFile</a>.at(type1-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>());
<a name="l00259"></a>00259     orbFile2 = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ac958ede00600b1671ac296b2f850a1b">_seg_orbFile</a>.at(type2-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>());
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     torbs1 = (state == -1) ? <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#cf6fb1fbba0f2aac9e7b7307de5c8d7b">_seg_torbs_e</a>.at(type1-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>()) :
<a name="l00262"></a>00262                              <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#6efdf54045117d44789484c3286ef4ca">_seg_torbs_h</a>.at(type1-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>());
<a name="l00263"></a>00263     torbs2 = (state == -1) ? <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#cf6fb1fbba0f2aac9e7b7307de5c8d7b">_seg_torbs_e</a>.at(type2-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>()) :
<a name="l00264"></a>00264                              <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#6efdf54045117d44789484c3286ef4ca">_seg_torbs_h</a>.at(type2-&gt;<a class="code" href="classvotca_1_1ctp_1_1SegmentType.html#496099b8870e3a87692e273f5f5165f1">getName</a>());
<a name="l00265"></a>00265     
<a name="l00266"></a>00266     <span class="comment">//string basisName1 = type1-&gt;getBasisName();</span>
<a name="l00267"></a>00267     <span class="comment">//string basisName2 = type2-&gt;getBasisName();</span>
<a name="l00268"></a>00268     <span class="comment">//string orbFile1 = type1-&gt;getOrbitalsFile();</span>
<a name="l00269"></a>00269     <span class="comment">//string orbFile2 = type2-&gt;getOrbitalsFile();</span>
<a name="l00270"></a>00270     <span class="comment">//vector&lt;int&gt; torbs1 = type1-&gt;getTOrbNrs();</span>
<a name="l00271"></a>00271     <span class="comment">//vector&lt;int&gt; torbs2 = type2-&gt;getTOrbNrs();</span>
<a name="l00272"></a>00272     
<a name="l00273"></a>00273     <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">MOO::mol_and_orb</a> *morb1 = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">MOO::mol_and_orb</a>();
<a name="l00274"></a>00274     <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">MOO::mol_and_orb</a> *morb2 = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html">MOO::mol_and_orb</a>();
<a name="l00275"></a>00275     <a class="code" href="classvotca_1_1moo_1_1basis__set.html">MOO::basis_set</a> *basis1 = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1basis__set.html">MOO::basis_set</a>();
<a name="l00276"></a>00276     <a class="code" href="classvotca_1_1moo_1_1basis__set.html">MOO::basis_set</a> *basis2 = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1basis__set.html">MOO::basis_set</a>();
<a name="l00277"></a>00277     <a class="code" href="classvotca_1_1moo_1_1orb.html">MOO::orb</a> *orb1   = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1orb.html">MOO::orb</a>();
<a name="l00278"></a>00278     <a class="code" href="classvotca_1_1moo_1_1orb.html">MOO::orb</a> *orb2   = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1orb.html">MOO::orb</a>();
<a name="l00279"></a>00279     <a class="code" href="classvotca_1_1moo_1_1fock.html" title="this class will contain the fock matrix and pointers to the molecules involved in...">MOO::fock</a> *fock12   = <span class="keyword">new</span> <a class="code" href="classvotca_1_1moo_1_1fock.html" title="this class will contain the fock matrix and pointers to the molecules involved in...">MOO::fock</a>();
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     vector&lt;int&gt; torbNrs1;
<a name="l00282"></a>00282     vector&lt;int&gt; torbNrs2;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="comment">// Define basis set //</span>
<a name="l00285"></a>00285     basis1-&gt;<a class="code" href="classvotca_1_1moo_1_1basis__set.html#90b33f8554d34d484499f65330cf78b9">set_basis_set</a>(basisName1);
<a name="l00286"></a>00286     morb1-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#02aa690fb6edaea5bf7461deee6119d5">define_bs</a>(basis1);
<a name="l00287"></a>00287     basis2-&gt;<a class="code" href="classvotca_1_1moo_1_1basis__set.html#90b33f8554d34d484499f65330cf78b9">set_basis_set</a>(basisName2);
<a name="l00288"></a>00288     morb2-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#02aa690fb6edaea5bf7461deee6119d5">define_bs</a>(basis2);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="comment">// Load QM coordinates //</span>
<a name="l00291"></a>00291     morb1-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#68d2518bf3d922907dce67f85b24a37a">init</a>(coordsFile1.c_str());
<a name="l00292"></a>00292     morb2-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#68d2518bf3d922907dce67f85b24a37a">init</a>(coordsFile2.c_str());
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">// Create orbitals //</span>
<a name="l00295"></a>00295     morb1-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8e284a23629e6cf335fbfce648358c32">init_orbitals</a>(*orb1, orbFile1.c_str());
<a name="l00296"></a>00296     morb2-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8e284a23629e6cf335fbfce648358c32">init_orbitals</a>(*orb2, orbFile2.c_str());
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     orb1-&gt;<a class="code" href="classvotca_1_1moo_1_1orb.html#465a96c5690237e23abd44e6c072d1c1" title="removes all orbitals except the a_th">strip_orbitals</a>(torbs1);
<a name="l00299"></a>00299     orb2-&gt;<a class="code" href="classvotca_1_1moo_1_1orb.html#465a96c5690237e23abd44e6c072d1c1" title="removes all orbitals except the a_th">strip_orbitals</a>(torbs2);
<a name="l00300"></a>00300     
<a name="l00301"></a>00301     <span class="keywordtype">int</span> frontier1 = torbs1.size();
<a name="l00302"></a>00302     <span class="keywordtype">int</span> frontier2 = torbs2.size();
<a name="l00303"></a>00303     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; frontier1; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) { torbNrs1.push_back(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>); }
<a name="l00304"></a>00304     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a> = 0; <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a> &lt; frontier2; <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a>++) { torbNrs2.push_back(<a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a>); }
<a name="l00305"></a>00305     
<a name="l00306"></a>00306     morb1-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#fffcd1f986810db594f8a6f26d39ac63" title="makes a list of start orbital on an atom and number if basis sets on that atom">assign_orb</a>(orb1);
<a name="l00307"></a>00307     morb2-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#fffcd1f986810db594f8a6f26d39ac63" title="makes a list of start orbital on an atom and number if basis sets on that atom">assign_orb</a>(orb2);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">// Initialise Fock matrix //</span>
<a name="l00310"></a>00310     fock12-&gt;<a class="code" href="classvotca_1_1moo_1_1fock.html#6c9c9649c0c99bb7431095febd9e4ff8">init</a>(*morb1, *morb2);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00314"></a>00314     <span class="comment">// Rotate + Translate to MD Frame: Mol&amp;Orb1 //</span>
<a name="l00315"></a>00315     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00316"></a>00316     
<a name="l00317"></a>00317     <span class="comment">// Rotate + Translate QM frame to MD frame, fragment-wise</span>
<a name="l00318"></a>00318     vector&lt; Fragment* &gt; ::iterator fit;
<a name="l00319"></a>00319     <span class="keywordflow">for</span> (fit = seg1-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();
<a name="l00320"></a>00320          fit &lt; seg1-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();
<a name="l00321"></a>00321          fit++) {
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         <span class="comment">// Centers of maps, rotation matrix MD2QM</span>
<a name="l00324"></a>00324         <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">Fragment</a> *frag = *fit;
<a name="l00325"></a>00325         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoMD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#d786476992582ecba39b544cb129fe49">getCoMD</a>();
<a name="l00326"></a>00326         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoQM = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#29468a0efc13921ea4d7e0e2cd3813b3">getCoQM</a>();
<a name="l00327"></a>00327         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> rotQM2MD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#e6a06d3180c6a09aa85265deb66953cc">getRotQM2MD</a>();
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         <span class="comment">// Fill container with atom QM indices</span>
<a name="l00330"></a>00330         vector&lt;int&gt; atmIdcs;
<a name="l00331"></a>00331         vector&lt; Atom* &gt; ::iterator ait;
<a name="l00332"></a>00332         <span class="keywordflow">for</span> (ait = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().begin();
<a name="l00333"></a>00333              ait &lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().end();
<a name="l00334"></a>00334              ait++) {
<a name="l00335"></a>00335              <span class="keywordflow">if</span> ( (*ait)-&gt;HasQMPart() ) {
<a name="l00336"></a>00336                  atmIdcs.push_back( (*ait)-&gt;getQMId()-1 );
<a name="l00337"></a>00337              }
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="comment">// Perform translation + rotation</span>
<a name="l00342"></a>00342         <span class="keyword">const</span> <span class="keywordtype">double</span> NM2Bohr= 10/0.529189379;
<a name="l00343"></a>00343         morb1-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#2f69f6b1f5f12ce101acf96cb1913270">rotate_someatoms</a>(atmIdcs, rotQM2MD,
<a name="l00344"></a>00344                                  CoMD*NM2Bohr, CoQM*NM2Bohr,
<a name="l00345"></a>00345                                  morb1);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         <span class="comment">// Rotate orbitals</span>
<a name="l00348"></a>00348         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; torbNrs1.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00349"></a>00349             orb1-&gt;<a class="code" href="classvotca_1_1moo_1_1orb.html#97536f480deb055d42f8cbde2e389c16">rotate_someatoms</a>(atmIdcs, &amp;rotQM2MD,
<a name="l00350"></a>00350                                     morb1-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#e3a21fdf969ad77d2c88adb746227321">getorb</a>(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>), <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00351"></a>00351         }
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353     
<a name="l00354"></a>00354     <span class="comment">//_morb1-&gt;write_pdb("morbs.pdb", "MOL", 1);</span>
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     
<a name="l00357"></a>00357     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00358"></a>00358     <span class="comment">// Rotate + Translate to MD Frame: Mol&amp;Orb2 //</span>
<a name="l00359"></a>00359     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">for</span> (fit = seg2-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();
<a name="l00362"></a>00362             fit &lt; seg2-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();
<a name="l00363"></a>00363             fit++) {
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">// Centers of maps, rotation matrix MD2QM</span>
<a name="l00366"></a>00366         <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">Fragment</a> *frag = *fit;
<a name="l00367"></a>00367         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoMD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#d786476992582ecba39b544cb129fe49">getCoMD</a>();
<a name="l00368"></a>00368         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoQM = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#29468a0efc13921ea4d7e0e2cd3813b3">getCoQM</a>();
<a name="l00369"></a>00369         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> rotQM2MD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#e6a06d3180c6a09aa85265deb66953cc">getRotQM2MD</a>();
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="comment">// Fill container with atom QM indices</span>
<a name="l00372"></a>00372         vector&lt;int&gt; atmIdcs;
<a name="l00373"></a>00373         vector&lt; Atom* &gt; ::iterator ait;
<a name="l00374"></a>00374         <span class="keywordflow">for</span> (ait = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().begin();
<a name="l00375"></a>00375              ait &lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().end();
<a name="l00376"></a>00376              ait++) {
<a name="l00377"></a>00377              <span class="keywordflow">if</span> ( (*ait)-&gt;HasQMPart() ) {
<a name="l00378"></a>00378                 atmIdcs.push_back( (*ait)-&gt;getQMId()-1 );
<a name="l00379"></a>00379              }
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="comment">// Perform translation + rotation</span>
<a name="l00384"></a>00384         <span class="keyword">const</span> <span class="keywordtype">double</span> NM2Bohr= 10/0.529189379;
<a name="l00385"></a>00385         morb2-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#2f69f6b1f5f12ce101acf96cb1913270">rotate_someatoms</a>(atmIdcs, rotQM2MD,
<a name="l00386"></a>00386                                  CoMD*NM2Bohr, CoQM*NM2Bohr,
<a name="l00387"></a>00387                                  morb2);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="comment">// Rotate orbitals</span>
<a name="l00390"></a>00390         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; torbNrs2.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00391"></a>00391             orb2-&gt;<a class="code" href="classvotca_1_1moo_1_1orb.html#97536f480deb055d42f8cbde2e389c16">rotate_someatoms</a>(atmIdcs, &amp;rotQM2MD,
<a name="l00392"></a>00392                                     morb2-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#e3a21fdf969ad77d2c88adb746227321">getorb</a>(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>), <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="comment">// ++++++++++++++++++++++++++++ //</span>
<a name="l00397"></a>00397     <span class="comment">// Calculate transfer integrals //</span>
<a name="l00398"></a>00398     <span class="comment">// ++++++++++++++++++++++++++++ //</span>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     
<a name="l00401"></a>00401     vector&lt;double&gt; Js;
<a name="l00402"></a>00402     std::pair&lt; int, int &gt; torb2torb;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; torbNrs1.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00405"></a>00405     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a> = 0; <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a> &lt; torbNrs2.size(); <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a>++) {
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         torb2torb.first  = torbNrs1[<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>];
<a name="l00408"></a>00408         torb2torb.second = torbNrs2[<a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a>];
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#89ffd2455d83fc70c39fa15781b3d2a6">_FockPath</a>.<a class="code" href="classvotca_1_1tools_1_1Mutex.html#82ecdca62e83a4be3bb8dadf404a48d9">Lock</a>();
<a name="l00411"></a>00411         <span class="keywordtype">double</span> J = fock12-&gt;<a class="code" href="classvotca_1_1moo_1_1fock.html#720a6656e65c5dbcc7d06c352c77d10b">calcJ</a>(torb2torb);
<a name="l00412"></a>00412         <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#89ffd2455d83fc70c39fa15781b3d2a6">_FockPath</a>.<a class="code" href="classvotca_1_1tools_1_1Mutex.html#98b8edeae80de9fa33f06faa55c1c053">Unlock</a>();
<a name="l00413"></a>00413 
<a name="l00414"></a>00414         Js.push_back(J);
<a name="l00415"></a>00415         
<a name="l00416"></a>00416     }}
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#de48dbe3a9df8572779aabc5dad44c06">setJs</a>(Js, state);
<a name="l00419"></a>00419     pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#564ccb7cd501d9cdb93ed7961356c260">setIsPathCarrier</a>(<span class="keyword">true</span>, state);
<a name="l00420"></a>00420     <span class="comment">//cout &lt;&lt; endl &lt;&lt; "Jeff2 " &lt;&lt; pair-&gt;getJeff2(state) &lt;&lt; " ___ state " &lt;&lt; state &lt;&lt; endl;</span>
<a name="l00421"></a>00421     <span class="comment">//cout &lt;&lt; "path  " &lt;&lt; pair-&gt;isPathCarrier(state) &lt;&lt; endl;</span>
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keyword">delete</span> morb1;
<a name="l00424"></a>00424     <span class="keyword">delete</span> morb2;
<a name="l00425"></a>00425     <span class="keyword">delete</span> basis1;
<a name="l00426"></a>00426     <span class="keyword">delete</span> basis2;
<a name="l00427"></a>00427     <span class="keyword">delete</span> orb1;
<a name="l00428"></a>00428     <span class="keyword">delete</span> orb2;
<a name="l00429"></a>00429     <span class="keyword">delete</span> fock12;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     torbNrs1.<a class="code" href="classvotca_1_1moo_1_1fock.html#39a7bf324d2f2e6aa301ef7b27ace155">clear</a>();
<a name="l00432"></a>00432     torbNrs2.clear();
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="classvotca_1_1ctp_1_1IZindo.html#029231cee7d7e27d9c34c7b9bf196119">00437</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#029231cee7d7e27d9c34c7b9bf196119">IZindo::CalculateJ</a>(<a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair) {
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <a class="code" href="classvotca_1_1ctp_1_1Segment.html">Segment</a> *seg1 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#b6f64a9a1299f322aa4c76ac39815327">Seg1PbCopy</a>();
<a name="l00440"></a>00440     <a class="code" href="classvotca_1_1ctp_1_1Segment.html">Segment</a> *seg2 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#8fd5eaaa0814e027e29a39bdf962469d">Seg2PbCopy</a>();
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00443"></a>00443     <span class="comment">// Rotate + Translate to MD Frame: Mol&amp;Orb1 //</span>
<a name="l00444"></a>00444     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="comment">// Rotate + Translate QM frame to MD frame, fragment-wise</span>
<a name="l00447"></a>00447     vector&lt; Fragment* &gt; ::iterator fit;
<a name="l00448"></a>00448     <span class="keywordflow">for</span> (fit = seg1-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();
<a name="l00449"></a>00449          fit &lt; seg1-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();
<a name="l00450"></a>00450          fit++) {
<a name="l00451"></a>00451 
<a name="l00452"></a>00452         <span class="comment">// Centers of maps, rotation matrix MD2QM</span>
<a name="l00453"></a>00453         <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">Fragment</a> *frag = *fit;
<a name="l00454"></a>00454         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoMD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#d786476992582ecba39b544cb129fe49">getCoMD</a>();
<a name="l00455"></a>00455         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoQM = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#29468a0efc13921ea4d7e0e2cd3813b3">getCoQM</a>();
<a name="l00456"></a>00456         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> rotQM2MD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#e6a06d3180c6a09aa85265deb66953cc">getRotQM2MD</a>();
<a name="l00457"></a>00457 
<a name="l00458"></a>00458         <span class="comment">// Fill container with atom QM indices</span>
<a name="l00459"></a>00459         vector&lt;int&gt; atmIdcs;
<a name="l00460"></a>00460         vector&lt; Atom* &gt; ::iterator ait;
<a name="l00461"></a>00461         <span class="keywordflow">for</span> (ait = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().begin();
<a name="l00462"></a>00462              ait &lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().end();
<a name="l00463"></a>00463              ait++) {
<a name="l00464"></a>00464              <span class="keywordflow">if</span> ( (*ait)-&gt;HasQMPart() ) {
<a name="l00465"></a>00465                  atmIdcs.push_back( (*ait)-&gt;getQMId()-1 );
<a name="l00466"></a>00466              }
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         <span class="comment">// Perform translation + rotation</span>
<a name="l00471"></a>00471         <span class="keyword">const</span> <span class="keywordtype">double</span> NM2Bohr= 10/0.529189379;
<a name="l00472"></a>00472         <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7798cac2cebbaa681dcbc9e04ac1a86a">_morb1</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#2f69f6b1f5f12ce101acf96cb1913270">rotate_someatoms</a>(atmIdcs, rotQM2MD,
<a name="l00473"></a>00473                                  CoMD*NM2Bohr, CoQM*NM2Bohr,
<a name="l00474"></a>00474                                  <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7798cac2cebbaa681dcbc9e04ac1a86a">_morb1</a>);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <span class="comment">// Rotate orbitals</span>
<a name="l00477"></a>00477         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; this-&gt;<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#082eb79ae2ac22cb72cd0b8ebcb10a61">_torbNrs1</a>.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00478"></a>00478             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#890e407e209b2bf8d22c215b484f9ce6">_orb1</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1orb.html#97536f480deb055d42f8cbde2e389c16">rotate_someatoms</a>(atmIdcs, &amp;rotQM2MD,
<a name="l00479"></a>00479                                     <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#7798cac2cebbaa681dcbc9e04ac1a86a">_morb1</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#e3a21fdf969ad77d2c88adb746227321">getorb</a>(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>), <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="comment">//_morb1-&gt;write_pdb("morbs.pdb", "MOL", 1);</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00487"></a>00487     <span class="comment">// Rotate + Translate to MD Frame: Mol&amp;Orb2 //</span>
<a name="l00488"></a>00488     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++ //</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="keywordflow">for</span> (fit = seg2-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().begin();
<a name="l00491"></a>00491             fit &lt; seg2-&gt;<a class="code" href="classvotca_1_1ctp_1_1Segment.html#8ce8c7dcfa3ca0f46600c398aa0a1288">Fragments</a>().end();
<a name="l00492"></a>00492             fit++) {
<a name="l00493"></a>00493 
<a name="l00494"></a>00494         <span class="comment">// Centers of maps, rotation matrix MD2QM</span>
<a name="l00495"></a>00495         <a class="code" href="classvotca_1_1ctp_1_1Fragment.html" title="Rigid fragment. One conjugated segment contains several rigid fragments.">Fragment</a> *frag = *fit;
<a name="l00496"></a>00496         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoMD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#d786476992582ecba39b544cb129fe49">getCoMD</a>();
<a name="l00497"></a>00497         <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> CoQM = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#29468a0efc13921ea4d7e0e2cd3813b3">getCoQM</a>();
<a name="l00498"></a>00498         <a class="code" href="classvotca_1_1tools_1_1matrix.html">matrix</a> rotQM2MD = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#e6a06d3180c6a09aa85265deb66953cc">getRotQM2MD</a>();
<a name="l00499"></a>00499 
<a name="l00500"></a>00500         <span class="comment">// Fill container with atom QM indices</span>
<a name="l00501"></a>00501         vector&lt;int&gt; atmIdcs;
<a name="l00502"></a>00502         vector&lt; Atom* &gt; ::iterator ait;
<a name="l00503"></a>00503         <span class="keywordflow">for</span> (ait = frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().begin();
<a name="l00504"></a>00504              ait &lt; frag-&gt;<a class="code" href="classvotca_1_1ctp_1_1Fragment.html#76a77f7ca04730a1cacba5533f61806f">Atoms</a>().end();
<a name="l00505"></a>00505              ait++) {
<a name="l00506"></a>00506              <span class="keywordflow">if</span> ( (*ait)-&gt;HasQMPart() ) {
<a name="l00507"></a>00507                 atmIdcs.push_back( (*ait)-&gt;getQMId()-1 );
<a name="l00508"></a>00508              }
<a name="l00509"></a>00509         }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512         <span class="comment">// Perform translation + rotation</span>
<a name="l00513"></a>00513         <span class="keyword">const</span> <span class="keywordtype">double</span> NM2Bohr= 10/0.529189379;
<a name="l00514"></a>00514         <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a1d8296aa208f5eb6944165876ad9b4f">_morb2</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#2f69f6b1f5f12ce101acf96cb1913270">rotate_someatoms</a>(atmIdcs, rotQM2MD,
<a name="l00515"></a>00515                                  CoMD*NM2Bohr, CoQM*NM2Bohr,
<a name="l00516"></a>00516                                  <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a1d8296aa208f5eb6944165876ad9b4f">_morb2</a>);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         <span class="comment">// Rotate orbitals</span>
<a name="l00519"></a>00519         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; this-&gt;<a class="code" href="classvotca_1_1ctp_1_1IZindo.html#714093b75041e4eb04787dc3bfe75377">_torbNrs2</a>.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00520"></a>00520             <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#e545cae3ac9f0651d9cf633717ea3091">_orb2</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1orb.html#97536f480deb055d42f8cbde2e389c16">rotate_someatoms</a>(atmIdcs, &amp;rotQM2MD,
<a name="l00521"></a>00521                                     <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#a1d8296aa208f5eb6944165876ad9b4f">_morb2</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#e3a21fdf969ad77d2c88adb746227321">getorb</a>(<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>), <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>);
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="comment">// ++++++++++++++++++++++++++++ //</span>
<a name="l00526"></a>00526     <span class="comment">// Calculate transfer integrals //</span>
<a name="l00527"></a>00527     <span class="comment">// ++++++++++++++++++++++++++++ //</span>
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     vector&lt;double&gt; Js;
<a name="l00531"></a>00531     std::pair&lt; int, int &gt; torb2torb;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> = 0; <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a> &lt; <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#082eb79ae2ac22cb72cd0b8ebcb10a61">_torbNrs1</a>.size(); <a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>++) {
<a name="l00534"></a>00534     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a> = 0; <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a> &lt; <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#714093b75041e4eb04787dc3bfe75377">_torbNrs2</a>.size(); <a class="code" href="namespaceDIPRO__TI.html#99261ba49d59ae81748f691217dc6721">j</a>++) {
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         torb2torb.first  = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#082eb79ae2ac22cb72cd0b8ebcb10a61">_torbNrs1</a>[<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>];
<a name="l00537"></a>00537         torb2torb.second = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#714093b75041e4eb04787dc3bfe75377">_torbNrs2</a>[<a class="code" href="namespacedensity__symmetrize.html#70312de6d597e9aea75ba426b32aa62c">i</a>];
<a name="l00538"></a>00538 
<a name="l00539"></a>00539         <span class="keywordtype">double</span> J = <a class="code" href="classvotca_1_1ctp_1_1IZindo.html#ec2250bbca8ce8e26ecbabcab3dc9908">_fock</a>-&gt;<a class="code" href="classvotca_1_1moo_1_1fock.html#720a6656e65c5dbcc7d06c352c77d10b">calcJ</a>(torb2torb);
<a name="l00540"></a>00540         Js.push_back(J);
<a name="l00541"></a>00541     }}
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     assert(<span class="keyword">false</span>); <span class="comment">// pair-&gt;setJs(Js);</span>
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 }}
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 <span class="preprocessor">#endif  </span><span class="comment">/* _CALC_INTEGRALS_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
