<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Votca: ctp/src/dipro/DIPRO-TI.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ctp/src/dipro/DIPRO-TI.f90</h1><a href="DIPRO-TI_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!</span>
<a name="l00002"></a>00002 <span class="comment">! Copyright 2009-2011 The VOTCA Development Team (http://www.votca.org)</span>
<a name="l00003"></a>00003 <span class="comment">!</span>
<a name="l00004"></a>00004 <span class="comment">! Licensed under the Apache License, Version 2.0 (the "License");</span>
<a name="l00005"></a>00005 <span class="comment">! you may not use this file except in compliance with the License.</span>
<a name="l00006"></a>00006 <span class="comment">! You may obtain a copy of the License at</span>
<a name="l00007"></a>00007 <span class="comment">!</span>
<a name="l00008"></a>00008 <span class="comment">!     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00009"></a>00009 <span class="comment">!</span>
<a name="l00010"></a>00010 <span class="comment">! Unless required by applicable law or agreed to in writing, software</span>
<a name="l00011"></a>00011 <span class="comment">! distributed under the License is distributed on an "AS IS" BASIS,</span>
<a name="l00012"></a>00012 <span class="comment">! WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00013"></a>00013 <span class="comment">! See the License for the specific language governing permissions and</span>
<a name="l00014"></a>00014 <span class="comment">! limitations under the License.</span>
<a name="l00015"></a>00015 <span class="comment">!</span>
<a name="l00016"></a><a class="code" href="namespaceorbitals.html">00016</a> <span class="keyword">module</span> orbitals
<a name="l00017"></a><a class="code" href="namespaceorbitals.html#484076bf7d276c89b85106cb79eea741">00017</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: molAcoef(:,:), molBcoef(:,:), dimcoef(:,:)
<a name="l00018"></a><a class="code" href="namespaceorbitals.html#25c1390f1132a35bc46fd0cc260cbbff">00018</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: molAener(:), molBener(:), dimen(:),fock_diag(:,:), S(:,:)
<a name="l00019"></a><a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">00019</a> <span class="keywordtype">character*3</span> QCP
<a name="l00020"></a><a class="code" href="namespaceorbitals.html#5877dcbee7b440ef50e3eb8cca42ee2a">00020</a> <span class="keywordtype">character*100</span> plabel
<a name="l00021"></a><a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">00021</a> <span class="keywordtype">integer</span> homoA, homoB, homoAsub, homoBsub
<a name="l00022"></a><a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">00022</a> <span class="keywordtype">integer</span> lumoA, lumoB, lumoAsub, lumoBsub
<a name="l00023"></a><a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">00023</a> <span class="keywordtype">integer</span> nA, nB, nD, nAt, nBt, nDt
<a name="l00024"></a><a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">00024</a> <span class="keywordtype">integer</span> n_QP_A, n_QP_B, n_QP_D
<a name="l00025"></a><a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">00025</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: J_hole(:,:)
<a name="l00026"></a><a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">00026</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: J_elec(:,:)
<a name="l00027"></a><a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">00027</a> <span class="keywordtype">integer</span>,<span class="keywordtype">allocatable</span> :: homoAind(:), homoBind(:), lumoAind(:), lumoBind(:)
<a name="l00028"></a><a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">00028</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: homoAboltz(:),homoBboltz(:),lumoAboltz(:),lumoBboltz(:)
<a name="l00029"></a><a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">00029</a> <span class="keywordtype">real*8</span> J_sq_degen_h, J_sq_degen_e, J_sq_boltz_h, J_sq_boltz_e
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="namespaceorbitals.html#02ce2f6ac68bfaf34de358bd02ac8a0c">00031</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: QPS_molA(:,:), QPS_molB(:,:), QPS_dim(:,:)
<a name="l00032"></a><a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">00032</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: QPE_molA(:), QPE_molB(:), QPE_dim(:,:)
<a name="l00033"></a><a class="code" href="namespaceorbitals.html#402a4f6316d101ac9409b058b28d574a">00033</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: QP_dimer_ProA(:,:), QP_dimer_ProB(:,:)
<a name="l00034"></a><a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">00034</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: QPA_DimBS(:,:), QPB_DimBS(:,:)
<a name="l00035"></a><a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">00035</a> <span class="keywordtype">integer</span> n_dim, n_dim_A, n_dim_B
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="keyword">end module orbitals</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="namespaceparameters.html">00039</a> <span class="keyword">module</span> parameters
<a name="l00040"></a><a class="code" href="namespaceparameters.html#8c595893af6fc29584028460a4a0d9bb">00040</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">parameter</span> :: conv_Hrt_eV=27.21138386d0
<a name="l00041"></a>00041 <span class="keyword">end module parameters</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="namespaceDIPRO__TI.html">00045</a> <span class="keyword">PROGRAM</span> DIPRO_TI
<a name="l00046"></a>00046 use <span class="keywordflow">orbitals</span>
<a name="l00047"></a>00047 <span class="keyword">IMPLICIT NONE</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="namespaceDIPRO__TI.html#aa3207fee2f180b19e5aad7cce2e5bf3">00049</a> <span class="keywordtype">character*100</span> linearg
<a name="l00050"></a><a class="code" href="namespaceDIPRO__TI.html#b81a2fa77203aeba875bacf38928f30d">00050</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: dimer_Pro(:,:) 
<a name="l00051"></a><a class="code" href="namespaceDIPRO__TI.html#83dd48427c0807813006c391338d632b">00051</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: PsiA_DimBS(:,:) 
<a name="l00052"></a><a class="code" href="namespaceDIPRO__TI.html#3b860a0699cd58fe6713f91407e85701">00052</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: PsiB_DimBS(:,:) 
<a name="l00053"></a><a class="code" href="namespaceDIPRO__TI.html#85a5585a4404ab600f44fddce99d1a6d">00053</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: helpmat(:,:)
<a name="l00054"></a><a class="code" href="namespaceDIPRO__TI.html#0d550af3b8fd83feb8464f0bc95acbfa">00054</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: JMAT(:,:)
<a name="l00055"></a><a class="code" href="namespaceDIPRO__TI.html#a01afc5b4476c00d109eb7ef902daab2">00055</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: SMAT(:,:)
<a name="l00056"></a><a class="code" href="namespaceDIPRO__TI.html#5e0173d802e37f7f9202d5da0788863c">00056</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: diagS(:,:), eigvec_t(:,:), transmat(:,:), JMAT_eff(:,:)
<a name="l00057"></a><a class="code" href="namespaceDIPRO__TI.html#8595b17bbcb540eca8a2c72264a790ad">00057</a> <span class="keywordtype">real*8</span>, <span class="keywordtype">allocatable</span> :: eigval(:),work(:),eigval_sq(:)
<a name="l00058"></a><a class="code" href="namespaceDIPRO__TI.html#992ae284a5960728b57a7c83a4b72d6b">00058</a> <span class="keywordtype">real*8</span> TI_hole, TI_elec, sum, tread
<a name="l00059"></a><a class="code" href="namespaceDIPRO__TI.html#3441f35c2f39d715182330617415a860">00059</a> <span class="keywordtype">integer</span> i,  info,lwork, j, arg,k,cnt
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">! number of basis functions and orbitals read from command line</span>
<a name="l00065"></a>00065 arg=1
<a name="l00066"></a>00066 CALL getarg(arg,LINEARG)
<a name="l00067"></a>00067 <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">if</span> (<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>.ne.0) <span class="keyword">then</span>
<a name="l00070"></a>00070    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>))
<a name="l00071"></a>00071    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00072"></a>00072       arg=arg+1
<a name="l00073"></a>00073       CALL getarg(arg,LINEARG)
<a name="l00074"></a>00074       <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>(i)
<a name="l00075"></a>00075    <span class="keyword">end do</span>
<a name="l00076"></a>00076 <span class="keyword">end if</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 arg=arg+1
<a name="l00079"></a>00079 CALL getarg(arg,LINEARG)
<a name="l00080"></a>00080 <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00081"></a>00081 <span class="keyword">if</span> (<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>.ne.0) <span class="keyword">then</span>
<a name="l00082"></a>00082    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>))
<a name="l00083"></a>00083    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00084"></a>00084       arg=arg+1
<a name="l00085"></a>00085       CALL getarg(arg,LINEARG)
<a name="l00086"></a>00086       <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>(i)
<a name="l00087"></a>00087    <span class="keyword">end do</span>
<a name="l00088"></a>00088 <span class="keyword">end if</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 arg=arg+1
<a name="l00092"></a>00092 CALL getarg(arg,LINEARG)
<a name="l00093"></a>00093 <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00094"></a>00094 <span class="keyword">if</span> (<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>.ne.0) <span class="keyword">then</span>
<a name="l00095"></a>00095    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#b2943c5d89803da3a5276b7fe32dbe9f">lumoAind</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>))
<a name="l00096"></a>00096    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00097"></a>00097       arg=arg+1
<a name="l00098"></a>00098       CALL getarg(arg,LINEARG)
<a name="l00099"></a>00099       <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#b2943c5d89803da3a5276b7fe32dbe9f">lumoAind</a>(i)
<a name="l00100"></a>00100    <span class="keyword">end do</span>
<a name="l00101"></a>00101 <span class="keyword">end if</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 arg=arg+1
<a name="l00105"></a>00105 CALL getarg(arg,LINEARG)
<a name="l00106"></a>00106 <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00107"></a>00107 <span class="keyword">if</span> (<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>.ne.0) <span class="keyword">then</span>
<a name="l00108"></a>00108    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">lumoBind</a>(<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>))
<a name="l00109"></a>00109    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00110"></a>00110       arg=arg+1
<a name="l00111"></a>00111       CALL getarg(arg,LINEARG)
<a name="l00112"></a>00112       <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">lumoBind</a>(i)
<a name="l00113"></a>00113    <span class="keyword">end do</span>
<a name="l00114"></a>00114 <span class="keyword">end if</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 arg=arg+1
<a name="l00117"></a>00117 CALL getarg(arg,LINEARG)
<a name="l00118"></a>00118 <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 arg=arg+1
<a name="l00121"></a>00121 CALL getarg(arg,LINEARG)
<a name="l00122"></a>00122 <span class="keyword">READ</span>(LINEARG,*) <a class="code" href="namespaceorbitals.html#5877dcbee7b440ef50e3eb8cca42ee2a">plabel</a>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a>=trim(<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a>)
<a name="l00125"></a>00125 <a class="code" href="namespaceorbitals.html#5877dcbee7b440ef50e3eb8cca42ee2a">plabel</a>=trim(<a class="code" href="namespaceorbitals.html#5877dcbee7b440ef50e3eb8cca42ee2a">plabel</a>)
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">! Check validity of QCP parameter</span>
<a name="l00128"></a>00128 <span class="keyword">if</span> (  (<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a> .ne. <span class="stringliteral">"T"</span>) .and. (<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a> .ne. <span class="stringliteral">"G"</span>) .and. (<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a> .ne. <span class="stringliteral">'GW'</span>) ) <span class="keyword">then</span>
<a name="l00129"></a>00129    <span class="keyword">write</span>(*,*) <span class="stringliteral">"Quantum-chemistry program not supported!"</span>
<a name="l00130"></a>00130    <span class="keyword">write</span>(*,*) <span class="stringliteral">"Specify G for Gaussian09,"</span>
<a name="l00131"></a>00131    <span class="keyword">write</span>(*,*) <span class="stringliteral">"        T for Turbomole"</span>
<a name="l00132"></a>00132    stop
<a name="l00133"></a>00133 <span class="keyword">end if</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">! Read orbital coefficients and orbital energies from QC software output</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="keyword">if</span> (<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a> .eq. <span class="stringliteral">"T"</span>) <span class="keyword">then</span>
<a name="l00138"></a>00138    CALL <a class="code" href="parsetools__noSCF_8f90.html#a3c47e99a68ef1a4400cf4ccc1d44324">parse_mols_TNS</a>
<a name="l00139"></a>00139    
<a name="l00140"></a>00140    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>,<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>),<a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>,<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>))
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00144"></a>00144       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00145"></a>00145          <a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j) = dot_product(<a class="code" href="namespaceorbitals.html#d2775b281f4e0ea9fdaf1e5ea2085e04">dimcoef</a>(<a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>(i),:),matmul(<a class="code" href="namespaceorbitals.html#62061dedd92762268319e49d845302eb">fock_diag</a>,<a class="code" href="namespaceorbitals.html#d2775b281f4e0ea9fdaf1e5ea2085e04">dimcoef</a>(<a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>(j),:)))
<a name="l00146"></a>00146       <span class="keyword">end do</span>
<a name="l00147"></a>00147    <span class="keyword">end do</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00150"></a>00150       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00151"></a>00151          <a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j) = dot_product(<a class="code" href="namespaceorbitals.html#d2775b281f4e0ea9fdaf1e5ea2085e04">dimcoef</a>(<a class="code" href="namespaceorbitals.html#b2943c5d89803da3a5276b7fe32dbe9f">lumoAind</a>(i),:),matmul(<a class="code" href="namespaceorbitals.html#62061dedd92762268319e49d845302eb">fock_diag</a>,<a class="code" href="namespaceorbitals.html#d2775b281f4e0ea9fdaf1e5ea2085e04">dimcoef</a>(<a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">lumoBind</a>(j),:)))
<a name="l00152"></a>00152       <span class="keyword">end do</span>
<a name="l00153"></a>00153    <span class="keyword">end do</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>),<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)) 
<a name="l00156"></a>00156    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>),<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>)) 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158    sum = 0.0d0
<a name="l00159"></a>00159    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00160"></a>00160       <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)=exp((<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>(i))-<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>(1)))/0.0256d0)
<a name="l00161"></a>00161       sum = sum + <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)
<a name="l00162"></a>00162    <span class="keyword">end do</span>
<a name="l00163"></a>00163    <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>=<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>/sqrt(sum)
<a name="l00164"></a>00164 
<a name="l00165"></a>00165    sum = 0.0d0
<a name="l00166"></a>00166    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00167"></a>00167       <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)=exp((<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>(i))-<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>(1)))/0.0256d0)
<a name="l00168"></a>00168       sum = sum + <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)*<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)
<a name="l00169"></a>00169    <span class="keyword">end do</span>
<a name="l00170"></a>00170    <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>=<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>/sqrt(sum)
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    sum = 0.0d0
<a name="l00174"></a>00174    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00175"></a>00175       <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)=exp(-(<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#b2943c5d89803da3a5276b7fe32dbe9f">lumoAind</a>(i))-<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#b2943c5d89803da3a5276b7fe32dbe9f">lumoAind</a>(1)))/0.0256d0)
<a name="l00176"></a>00176       sum = sum + <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)
<a name="l00177"></a>00177    <span class="keyword">end do</span>
<a name="l00178"></a>00178    <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>=<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>/sqrt(sum)
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    sum = 0.0d0
<a name="l00181"></a>00181    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00182"></a>00182       <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)=exp(-(<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">lumoBind</a>(i))-<a class="code" href="namespaceorbitals.html#f86c8b62961e65b510188865e33cbe77">dimen</a>(<a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">lumoBind</a>(1)))/0.0256d0)
<a name="l00183"></a>00183       sum = sum + <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)*<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)
<a name="l00184"></a>00184    <span class="keyword">end do</span>
<a name="l00185"></a>00185    <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>=<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>/sqrt(sum)
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a>00188    <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = 0.0d0
<a name="l00189"></a>00189    <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> = 0.0d0
<a name="l00190"></a>00190    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00191"></a>00191       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00192"></a>00192          <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> + <a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j)**2.0d0
<a name="l00193"></a>00193          <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> = <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> + (<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j)*<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(j))**2.0d0
<a name="l00194"></a>00194       <span class="keyword">end do</span>
<a name="l00195"></a>00195    <span class="keyword">end do</span>
<a name="l00196"></a>00196    <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a>/dble(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>*<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)
<a name="l00197"></a>00197 
<a name="l00198"></a>00198    <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = 0.0d0
<a name="l00199"></a>00199    <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> = 0.0d0
<a name="l00200"></a>00200    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00201"></a>00201       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00202"></a>00202          <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> + <a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j)**2.0d0
<a name="l00203"></a>00203          <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> = <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> + (<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j)*<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(j))**2.0d0
<a name="l00204"></a>00204       <span class="keyword">end do</span>
<a name="l00205"></a>00205    <span class="keyword">end do</span>
<a name="l00206"></a>00206    <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a>/dble(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>*<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>)
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 
<a name="l00209"></a>00209    <span class="comment">! Call data to XML output function (TO BE COMPLETED!)</span>
<a name="l00210"></a>00210    CALL <a class="code" href="output_8f90.html#d796672c6d4f91f9fdc24fd5eef86043">XMLoutput</a>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="keyword">else</span> <span class="keyword">if</span> ( (<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a> .eq. <span class="stringliteral">"G"</span>) ) <span class="keyword">then</span>
<a name="l00213"></a>00213    CALL <a class="code" href="parsetools_8f90.html#5754bd703ef6ad8cd05efdee77dddb38">parse_mols</a>
<a name="l00214"></a>00214    <span class="keyword">write</span>(*,*) <span class="stringliteral">"Reading done!"</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216    <span class="comment">! Take mo - the alpha electrons to get matrix in correct order</span>
<a name="l00217"></a>00217    <span class="keyword">allocate</span>( dimer_Pro(<a class="code" href="namespaceorbitals.html#0e9edf6aff3034094a9ec2bc25fddc24">nD</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>) )
<a name="l00218"></a>00218    dimer_Pro = transpose(matmul(<a class="code" href="namespaceorbitals.html#d2775b281f4e0ea9fdaf1e5ea2085e04">dimcoef</a>,<a class="code" href="namespaceorbitals.html#25c1390f1132a35bc46fd0cc260cbbff">S</a>))
<a name="l00219"></a>00219 
<a name="l00220"></a>00220    <span class="comment">! Determine orbitals of monomers in the basis set of the dimer</span>
<a name="l00221"></a>00221    <span class="keyword">allocate</span>( PsiA_DimBS(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>), PsiB_DimBS(<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>) )
<a name="l00222"></a>00222    PsiA_DimBS = matmul(<a class="code" href="namespaceorbitals.html#09c1340927e968bd293c7901d03d6b0e">molAcoef</a>, dimer_Pro)
<a name="l00223"></a>00223    PsiB_DimBS = matmul(<a class="code" href="namespaceorbitals.html#484076bf7d276c89b85106cb79eea741">molBcoef</a>, dimer_Pro)
<a name="l00224"></a>00224 
<a name="l00225"></a>00225    <span class="keyword">allocate</span>(helpmat(<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>))
<a name="l00226"></a>00226    helpmat=matmul( PsiB_DimBS, <a class="code" href="namespaceorbitals.html#62061dedd92762268319e49d845302eb">fock_diag</a>)
<a name="l00227"></a>00227 
<a name="l00228"></a>00228    <span class="comment">! Determine transfer matrix JAB and site energies JAA, JBB</span>
<a name="l00229"></a>00229    <span class="keyword">allocate</span>( JMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>), SMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>) )
<a name="l00230"></a>00230    JMAT(1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>,1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>) = matmul(matmul( PsiA_DimBS, <a class="code" href="namespaceorbitals.html#62061dedd92762268319e49d845302eb">fock_diag</a>) , transpose(PsiA_DimBS) )
<a name="l00231"></a>00231    JMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>) =   matmul(helpmat , transpose(PsiA_DimBS) )
<a name="l00232"></a>00232    JMAT(1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>) = transpose( JMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>))
<a name="l00233"></a>00233    JMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>) = matmul(helpmat , transpose(PsiB_DimBS) )
<a name="l00234"></a>00234 
<a name="l00235"></a>00235    <span class="comment">! Determine overlap analogous to J</span>
<a name="l00236"></a>00236    SMAT(1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>,1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>) = matmul(PsiA_DimBS , transpose(PsiA_DimBS) )
<a name="l00237"></a>00237    SMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>)= matmul(PsiB_DimBS , transpose(PsiB_DimBS) )
<a name="l00238"></a>00238    SMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>) = matmul(PsiB_DimBS , transpose(PsiA_DimBS) )
<a name="l00239"></a>00239    SMAT(1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>) = transpose( SMAT(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>))
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242    <span class="comment">! Determine eigenvales (evalu) and eigenvectors (evec) of overlap matrix</span>
<a name="l00243"></a>00243    lwork=3*(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>)
<a name="l00244"></a>00244    <span class="keyword">allocate</span>(eigval(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>),work(lwork),eigval_sq(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>))
<a name="l00245"></a>00245    call DSYEV(<span class="stringliteral">'V'</span>,<span class="stringliteral">'U'</span>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,SMAT,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,eigval,work,lwork,info)
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="comment">! Construct orthogonalization matrix (transmat)</span>
<a name="l00248"></a>00248    <span class="keyword">allocate</span>( diagS(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>), eigvec_t(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>), transmat(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>) )
<a name="l00249"></a>00249    <span class="comment">!eigval_sq     = sqrt(eigval)</span>
<a name="l00250"></a>00250    diagS = 0.0d0
<a name="l00251"></a>00251    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>
<a name="l00252"></a>00252       diagS(i,i) = 1.0d0/sqrt(eigval(i))
<a name="l00253"></a>00253    <span class="keyword">end do</span>
<a name="l00254"></a>00254    eigvec_t = transpose(SMAT)
<a name="l00255"></a>00255    transmat = matmul(SMAT, matmul(diagS,eigvec_t))
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 
<a name="l00258"></a>00258    <span class="comment">! Calculate effective JMAT</span>
<a name="l00259"></a>00259    <span class="keyword">allocate</span>(JMAT_eff(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>))
<a name="l00260"></a>00260    JMAT_eff = matmul( transmat, matmul(JMAT,transmat) )
<a name="l00261"></a>00261    
<a name="l00262"></a>00262    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>,<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>),<a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>,<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>))
<a name="l00263"></a>00263 
<a name="l00264"></a>00264    <a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a> = JMAT_eff(1:<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+1:<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)
<a name="l00265"></a>00265    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00266"></a>00266       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00267"></a>00267          <a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j) = JMAT_eff(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+i,<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+j)
<a name="l00268"></a>00268       <span class="keyword">end do</span>
<a name="l00269"></a>00269    <span class="keyword">end do</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271    <span class="comment">! Degenercay runs </span>
<a name="l00272"></a>00272    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>),<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)) 
<a name="l00273"></a>00273    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>),<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>)) 
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    sum = 0.0d0
<a name="l00276"></a>00276    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00277"></a>00277       <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)=exp((<a class="code" href="namespaceorbitals.html#89fe3cadf0d624320626b821bc08f64b">molAener</a>(i)-<a class="code" href="namespaceorbitals.html#89fe3cadf0d624320626b821bc08f64b">molAener</a>(1))/0.0256d0)
<a name="l00278"></a>00278       sum = sum + <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)
<a name="l00279"></a>00279    <span class="keyword">end do</span>
<a name="l00280"></a>00280    <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>=<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>/sqrt(sum)
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    sum = 0.0d0
<a name="l00283"></a>00283    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00284"></a>00284       <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)=exp((<a class="code" href="namespaceorbitals.html#d17b0d76bd2bc48c72e418ae79370c62">molBener</a>(i)-<a class="code" href="namespaceorbitals.html#d17b0d76bd2bc48c72e418ae79370c62">molBener</a>(1))/0.0256d0)
<a name="l00285"></a>00285       sum = sum + <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)*<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)
<a name="l00286"></a>00286    <span class="keyword">end do</span>
<a name="l00287"></a>00287    <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>=<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>/sqrt(sum)
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 
<a name="l00290"></a>00290    sum = 0.0d0
<a name="l00291"></a>00291    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00292"></a>00292       <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)=exp(-(<a class="code" href="namespaceorbitals.html#89fe3cadf0d624320626b821bc08f64b">molAener</a>(i+<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>)-<a class="code" href="namespaceorbitals.html#89fe3cadf0d624320626b821bc08f64b">molAener</a>(1+<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>))/0.0256d0)
<a name="l00293"></a>00293       sum = sum + <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)
<a name="l00294"></a>00294    <span class="keyword">end do</span>
<a name="l00295"></a>00295    <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>=<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>/sqrt(sum)
<a name="l00296"></a>00296 
<a name="l00297"></a>00297    sum = 0.0d0
<a name="l00298"></a>00298    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00299"></a>00299       <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)=exp(-(<a class="code" href="namespaceorbitals.html#d17b0d76bd2bc48c72e418ae79370c62">molBener</a>(i+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)-<a class="code" href="namespaceorbitals.html#d17b0d76bd2bc48c72e418ae79370c62">molBener</a>(1+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>))/0.0256d0)
<a name="l00300"></a>00300       sum = sum + <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)*<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)
<a name="l00301"></a>00301    <span class="keyword">end do</span>
<a name="l00302"></a>00302    <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>=<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>/sqrt(sum)
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 
<a name="l00305"></a>00305    <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = 0.0d0
<a name="l00306"></a>00306    <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> = 0.0d0
<a name="l00307"></a>00307    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00308"></a>00308       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00309"></a>00309          <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> + <a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j)**2.0d0
<a name="l00310"></a>00310          <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> = <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> + (<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j)*<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(j))**2.0d0
<a name="l00311"></a>00311       <span class="keyword">end do</span>
<a name="l00312"></a>00312    <span class="keyword">end do</span>
<a name="l00313"></a>00313    <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a>/dble(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>*<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)
<a name="l00314"></a>00314 
<a name="l00315"></a>00315    <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = 0.0d0
<a name="l00316"></a>00316    <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> = 0.0d0
<a name="l00317"></a>00317    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00318"></a>00318       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00319"></a>00319          <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> + <a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j)**2.0d0
<a name="l00320"></a>00320          <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> = <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> + (<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j)*<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(j))**2.0d0
<a name="l00321"></a>00321       <span class="keyword">end do</span>
<a name="l00322"></a>00322    <span class="keyword">end do</span>
<a name="l00323"></a>00323    <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a>/dble(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>*<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>)
<a name="l00324"></a>00324 
<a name="l00325"></a>00325    <span class="comment">! Call data to XML output function (TO BE COMPLETED!)</span>
<a name="l00326"></a>00326    CALL <a class="code" href="output_8f90.html#d796672c6d4f91f9fdc24fd5eef86043">XMLoutput</a>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="keyword">else</span> <span class="keyword">if</span> (<a class="code" href="namespaceorbitals.html#bab6f3d0fceaa26e59c6c9d69d8f0921">QCP</a>.eq.<span class="stringliteral">"GW"</span>) <span class="keyword">then</span>
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <span class="comment">! Now, we have to read the energies and expansion coefficients of th</span>
<a name="l00331"></a>00331    <span class="comment">! quasiparticle states from the respective diag_qp.out files.</span>
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <span class="comment">! Open files for parsing</span>
<a name="l00334"></a>00334    <span class="keyword">open</span>(10,file=<span class="stringliteral">"diag_QP.dat"</span>, status=<span class="stringliteral">"old"</span>)
<a name="l00335"></a>00335    <span class="keyword">open</span>(11,file=<span class="stringliteral">"../molA/diag_QP.dat"</span>, status=<span class="stringliteral">"old"</span>)
<a name="l00336"></a>00336    <span class="keyword">open</span>(12,file=<span class="stringliteral">"../molB/diag_QP.dat"</span>, status=<span class="stringliteral">"old"</span>)
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="keyword">write</span>(*,*) <span class="stringliteral">"Entering GW extension"</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340    <span class="comment">! molA, only read the QP states we need </span>
<a name="l00341"></a>00341    <span class="keyword">read</span>(11,*) <a class="code" href="namespaceorbitals.html#bd7e10d082fbeed58ae690a543f89f1e">n_QP_A</a>
<a name="l00342"></a>00342    <span class="keyword">allocate</span>( <a class="code" href="namespaceorbitals.html#78a73ec7ebf06c00058ab3e8d7dfdc8e">QPS_molA</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>,<a class="code" href="namespaceorbitals.html#bd7e10d082fbeed58ae690a543f89f1e">n_QP_A</a>), <a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>(<a class="code" href="namespaceorbitals.html#bd7e10d082fbeed58ae690a543f89f1e">n_QP_A</a>) )
<a name="l00343"></a>00343    cnt=0
<a name="l00344"></a>00344    <span class="keyword">do</span> i = 1, maxval(<a class="code" href="namespaceorbitals.html#b2943c5d89803da3a5276b7fe32dbe9f">lumoAind</a>)
<a name="l00345"></a>00345       <span class="keyword">read</span>(11,*) k, tread
<a name="l00346"></a>00346       <span class="keyword">if</span> ( i .ge. minval(<a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>)) <span class="keyword">then</span>
<a name="l00347"></a>00347          cnt = cnt+1
<a name="l00348"></a>00348          <a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>(cnt) = tread
<a name="l00349"></a>00349       <span class="keyword">end if</span>
<a name="l00350"></a>00350       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#bd7e10d082fbeed58ae690a543f89f1e">n_QP_A</a>
<a name="l00351"></a>00351          <span class="keyword">read</span>(11,*) k, tread
<a name="l00352"></a>00352          <span class="keyword">if</span> (i .ge. minval(<a class="code" href="namespaceorbitals.html#787e3b33db62becec8d9602d89a5c003">homoAind</a>)) <span class="keyword">then</span>
<a name="l00353"></a>00353             <a class="code" href="namespaceorbitals.html#78a73ec7ebf06c00058ab3e8d7dfdc8e">QPS_molA</a>(cnt,j) = tread
<a name="l00354"></a>00354          <span class="keyword">end if</span>
<a name="l00355"></a>00355       <span class="keyword">end do</span>
<a name="l00356"></a>00356    <span class="keyword">end do</span>
<a name="l00357"></a>00357    <span class="keyword">close</span>(11)
<a name="l00358"></a>00358 
<a name="l00359"></a>00359    <a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a> = <a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>*13.605d0
<a name="l00360"></a>00360    <span class="keyword">write</span>(*,*) <span class="stringliteral">"read from molA"</span>, <a class="code" href="namespaceorbitals.html#bd7e10d082fbeed58ae690a543f89f1e">n_QP_A</a>
<a name="l00361"></a>00361 
<a name="l00362"></a>00362    <span class="comment">! molB</span>
<a name="l00363"></a>00363    <span class="keyword">read</span>(12,*) <a class="code" href="namespaceorbitals.html#41893f330fe78920b552dff4ca66bf6e">n_QP_B</a>
<a name="l00364"></a>00364    <span class="keyword">allocate</span>( <a class="code" href="namespaceorbitals.html#02ce2f6ac68bfaf34de358bd02ac8a0c">QPS_molB</a>(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>,<a class="code" href="namespaceorbitals.html#41893f330fe78920b552dff4ca66bf6e">n_QP_B</a>), <a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>(<a class="code" href="namespaceorbitals.html#41893f330fe78920b552dff4ca66bf6e">n_QP_B</a>) )
<a name="l00365"></a>00365    cnt=0
<a name="l00366"></a>00366    <span class="keyword">do</span> i = 1, maxval(<a class="code" href="namespaceorbitals.html#b90e83b5143d3e45ea1dbcb53835a45a">lumoBind</a>)
<a name="l00367"></a>00367       <span class="keyword">read</span>(12,*) k, tread
<a name="l00368"></a>00368       <span class="keyword">if</span> (i .ge. minval(<a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>)) <span class="keyword">then</span>
<a name="l00369"></a>00369          cnt=cnt+1
<a name="l00370"></a>00370          <a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>(cnt) = tread
<a name="l00371"></a>00371       <span class="keyword">end if</span>
<a name="l00372"></a>00372       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#41893f330fe78920b552dff4ca66bf6e">n_QP_B</a>
<a name="l00373"></a>00373          <span class="keyword">read</span>(12,*) k, tread
<a name="l00374"></a>00374          <span class="keyword">if</span> (i.ge.minval(<a class="code" href="namespaceorbitals.html#e9ed5a11607160326844efdaf7711127">homoBind</a>)) <span class="keyword">then</span>
<a name="l00375"></a>00375             <a class="code" href="namespaceorbitals.html#02ce2f6ac68bfaf34de358bd02ac8a0c">QPS_molB</a>(cnt,j) = tread
<a name="l00376"></a>00376          <span class="keyword">end if</span>
<a name="l00377"></a>00377       <span class="keyword">end do</span>
<a name="l00378"></a>00378    <span class="keyword">end do</span>
<a name="l00379"></a>00379    <span class="keyword">close</span>(12)
<a name="l00380"></a>00380    <a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a> = <a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>*13.605d0
<a name="l00381"></a>00381 
<a name="l00382"></a>00382    <span class="keyword">write</span>(*,*) <span class="stringliteral">"read from molB"</span>, <a class="code" href="namespaceorbitals.html#41893f330fe78920b552dff4ca66bf6e">n_QP_B</a>
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    <span class="comment">! dimer</span>
<a name="l00385"></a>00385    <span class="keyword">read</span>(10,*) <a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>
<a name="l00386"></a>00386    <span class="keyword">allocate</span>( <a class="code" href="namespaceorbitals.html#b83bcf6c67bc980fd04a7d1715452b16">QPS_dim</a>(<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>), <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a>(<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>) )
<a name="l00387"></a>00387    <a class="code" href="namespaceorbitals.html#b83bcf6c67bc980fd04a7d1715452b16">QPS_dim</a> = 0.0d0
<a name="l00388"></a>00388    <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a> = 0.0d0
<a name="l00389"></a>00389    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>
<a name="l00390"></a>00390       <span class="keyword">read</span>(10,*) k, <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a>(i,i)
<a name="l00391"></a>00391       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>
<a name="l00392"></a>00392          <span class="keyword">read</span>(10,*) k, <a class="code" href="namespaceorbitals.html#b83bcf6c67bc980fd04a7d1715452b16">QPS_dim</a>(i,j)
<a name="l00393"></a>00393       <span class="keyword">end do</span>
<a name="l00394"></a>00394    <span class="keyword">end do</span>
<a name="l00395"></a>00395    <span class="keyword">close</span>(10)
<a name="l00396"></a>00396    <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a> = <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a>*13.605d0
<a name="l00397"></a>00397 
<a name="l00398"></a>00398    <span class="keyword">write</span>(*,*) <span class="stringliteral">"read from dimer"</span>, <a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400    
<a name="l00401"></a>00401    <span class="comment">! NOW, the parsing of the KS data must be adjusted to fit the GW states</span>
<a name="l00402"></a>00402    CALL <a class="code" href="parsetools_8f90.html#5754bd703ef6ad8cd05efdee77dddb38">parse_mols</a>
<a name="l00403"></a>00403    <span class="keyword">write</span>(*,*) <span class="stringliteral">"Reading done!"</span>
<a name="l00404"></a>00404 
<a name="l00405"></a>00405    <span class="comment">! Take mo - the alpha electrons to get matrix in correct order</span>
<a name="l00406"></a>00406    <span class="keyword">allocate</span>( dimer_Pro(<a class="code" href="namespaceorbitals.html#0e9edf6aff3034094a9ec2bc25fddc24">nD</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>) )
<a name="l00407"></a>00407    dimer_Pro = transpose(matmul(<a class="code" href="namespaceorbitals.html#d2775b281f4e0ea9fdaf1e5ea2085e04">dimcoef</a>,<a class="code" href="namespaceorbitals.html#25c1390f1132a35bc46fd0cc260cbbff">S</a>))
<a name="l00408"></a>00408 
<a name="l00409"></a>00409    <span class="comment">! Determine orbitals of monomers in the basis set of the dimer</span>
<a name="l00410"></a>00410    <span class="keyword">allocate</span>( PsiA_DimBS(<a class="code" href="namespaceorbitals.html#f2c7d24442882f1bbfdd55df0fbcbbef">nAt</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>), PsiB_DimBS(<a class="code" href="namespaceorbitals.html#ef641917a7e3e07f2c50e5eb6327383a">nBt</a>,<a class="code" href="namespaceorbitals.html#e1e4c7a6270ca61700d381189e89808d">nDt</a>) )
<a name="l00411"></a>00411    PsiA_DimBS = matmul(<a class="code" href="namespaceorbitals.html#09c1340927e968bd293c7901d03d6b0e">molAcoef</a>, dimer_Pro)
<a name="l00412"></a>00412    PsiB_DimBS = matmul(<a class="code" href="namespaceorbitals.html#484076bf7d276c89b85106cb79eea741">molBcoef</a>, dimer_Pro)
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a>00417    <span class="comment">! Take dimer QP states and multiply by overlap matrix &lt;KS_A|KS_D&gt;</span>
<a name="l00418"></a>00418    <span class="keyword">allocate</span>( <a class="code" href="namespaceorbitals.html#74ec48a206b9f0a943c6de09f734a811">QP_dimer_ProA</a>(<a class="code" href="namespaceorbitals.html#bd7e10d082fbeed58ae690a543f89f1e">n_QP_A</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>), <a class="code" href="namespaceorbitals.html#402a4f6316d101ac9409b058b28d574a">QP_dimer_ProB</a>(<a class="code" href="namespaceorbitals.html#41893f330fe78920b552dff4ca66bf6e">n_QP_B</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>) )
<a name="l00419"></a>00419    <a class="code" href="namespaceorbitals.html#74ec48a206b9f0a943c6de09f734a811">QP_dimer_ProA</a> = matmul(PsiA_DimBS(:,1:<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>),transpose(<a class="code" href="namespaceorbitals.html#b83bcf6c67bc980fd04a7d1715452b16">QPS_dim</a>))
<a name="l00420"></a>00420    <a class="code" href="namespaceorbitals.html#402a4f6316d101ac9409b058b28d574a">QP_dimer_ProB</a> = matmul(PsiB_DimBS(:,1:<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>),transpose(<a class="code" href="namespaceorbitals.html#b83bcf6c67bc980fd04a7d1715452b16">QPS_dim</a>))
<a name="l00421"></a>00421    <span class="comment">! QP_dimer_ProX contain the terms (mat(S)xvec(d)_i) on the columns</span>
<a name="l00422"></a>00422 
<a name="l00423"></a>00423    <span class="keyword">write</span>(*,*) <span class="stringliteral">"calculated QP_diemr_ProX"</span>
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 <span class="comment">!   write(*,*) QP_dimer_ProB</span>
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="comment">! Determine orbitals of monomers in the basis set of the dimer</span>
<a name="l00429"></a>00429    <span class="keyword">allocate</span>( <a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>), <a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a>(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>) )
<a name="l00430"></a>00430    <a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a> = matmul(<a class="code" href="namespaceorbitals.html#78a73ec7ebf06c00058ab3e8d7dfdc8e">QPS_molA</a>, <a class="code" href="namespaceorbitals.html#74ec48a206b9f0a943c6de09f734a811">QP_dimer_ProA</a>)
<a name="l00431"></a>00431    <a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a> = matmul(<a class="code" href="namespaceorbitals.html#02ce2f6ac68bfaf34de358bd02ac8a0c">QPS_molB</a>, <a class="code" href="namespaceorbitals.html#402a4f6316d101ac9409b058b28d574a">QP_dimer_ProB</a>)
<a name="l00432"></a>00432    <span class="comment">! QPX_DimBS(i,j) contain the projection of the i-th QP state of molX</span>
<a name="l00433"></a>00433    <span class="comment">!                on the j-th QP state of the dimer</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435    <span class="keyword">write</span>(*,*) <span class="stringliteral">"calculated QPX_DimBS"</span>
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="comment">!   write(*,*) QPB_DimBS</span>
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="keyword">allocate</span>(helpmat(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>,<a class="code" href="namespaceorbitals.html#8c52dada1e2a9b323a343cfca7ea585d">n_QP_D</a>))
<a name="l00440"></a>00440    helpmat=matmul( <a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a>, <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a>)
<a name="l00441"></a>00441 
<a name="l00442"></a>00442    <span class="keyword">write</span>(*,*) <span class="stringliteral">"calculated helpmat"</span>
<a name="l00443"></a>00443 <span class="comment">!   write(*,*) helpmat</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <span class="comment">! Determine transfer matrix JAB and site energies JAA, JBB</span>
<a name="l00446"></a>00446 <span class="comment">!   allocate( JMAT(n_QP_A+n_QP_B,n_QP_A+n_QP_B), SMAT(n_QP_A+n_QP_B,n_QP_A+n_QP_B))</span>
<a name="l00447"></a>00447    <a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>   = <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00448"></a>00448    <a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a> = <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00449"></a>00449    <a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a> = <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00450"></a>00450 
<a name="l00451"></a>00451    <span class="keyword">allocate</span>( JMAT(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>), SMAT(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>))
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    JMAT(1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>,1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>) = matmul(matmul( <a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a>, <a class="code" href="namespaceorbitals.html#0e2ce94d1c595929dea4f70fcde702c0">QPE_dim</a>),transpose(<a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a>) )
<a name="l00454"></a>00454    JMAT(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>,1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>) = matmul(helpmat , transpose(<a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a>) )
<a name="l00455"></a>00455    JMAT(1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>) = transpose( JMAT(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>,1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>))
<a name="l00456"></a>00456    JMAT(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>) = matmul(helpmat , transpose(<a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a>) )
<a name="l00457"></a>00457 
<a name="l00458"></a>00458    <span class="keyword">write</span>(*,*) <span class="stringliteral">"calculated JMAT"</span>
<a name="l00459"></a>00459 <span class="comment">!   write(*,*) JMAT</span>
<a name="l00460"></a>00460 
<a name="l00461"></a>00461    <span class="comment">! Determine overlap analogous to J</span>
<a name="l00462"></a>00462    SMAT(1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>,1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>) = matmul(<a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a> , transpose(<a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a>) )
<a name="l00463"></a>00463    SMAT(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>)= matmul(<a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a> , transpose(<a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a>) )
<a name="l00464"></a>00464    SMAT(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>,1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>) = matmul(<a class="code" href="namespaceorbitals.html#622ff394f6a46f7a2f6eb3410319a79a">QPB_DimBS</a> , transpose(<a class="code" href="namespaceorbitals.html#74d0afced64deecbf5a94d1884a0f29d">QPA_DimBS</a>) )
<a name="l00465"></a>00465    SMAT(1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>) = transpose( SMAT(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#ac9a62d55edab7a0f28a806583fc8e09">n_dim_B</a>,1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>))
<a name="l00466"></a>00466 
<a name="l00467"></a>00467    <span class="keyword">write</span>(*,*) <span class="stringliteral">"calculated SMAT"</span>
<a name="l00468"></a>00468 <span class="comment">!   write(*,*) SMAT</span>
<a name="l00469"></a>00469 
<a name="l00470"></a>00470    <span class="comment">! Determine eigenvales (evalu) and eigenvectors (evec) of overlap matrix</span>
<a name="l00471"></a>00471    lwork=3*(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>)
<a name="l00472"></a>00472    <span class="keyword">allocate</span>(eigval(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>),work(lwork),eigval_sq(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>))
<a name="l00473"></a>00473    call DSYEV(<span class="stringliteral">'V'</span>,<span class="stringliteral">'U'</span>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,SMAT,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,eigval,work,lwork,info)
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 <span class="comment">!   write(*,*) info</span>
<a name="l00476"></a>00476 
<a name="l00477"></a>00477    <span class="comment">! Construct orthogonalization matrix (transmat)</span>
<a name="l00478"></a>00478    <span class="keyword">allocate</span>( diagS(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>), eigvec_t(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>), transmat(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>) )
<a name="l00479"></a>00479    <span class="comment">!eigval_sq     = sqrt(eigval)</span>
<a name="l00480"></a>00480    diagS = 0.0d0
<a name="l00481"></a>00481    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>
<a name="l00482"></a>00482       diagS(i,i) = 1.0d0/sqrt(eigval(i))
<a name="l00483"></a>00483    <span class="keyword">end do</span>
<a name="l00484"></a>00484    eigvec_t = transpose(SMAT)
<a name="l00485"></a>00485    transmat = matmul(SMAT, matmul(diagS,eigvec_t))
<a name="l00486"></a>00486 
<a name="l00487"></a>00487    <span class="comment">! Calculate effective JMAT</span>
<a name="l00488"></a>00488    <span class="keyword">allocate</span>(JMAT_eff(<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>,<a class="code" href="namespaceorbitals.html#bcf39ac9c1265b6377d744f2f81c7941">n_dim</a>))
<a name="l00489"></a>00489    JMAT_eff = matmul( transmat, matmul(JMAT,transmat) )
<a name="l00490"></a>00490    
<a name="l00491"></a>00491    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>,<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>),<a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>,<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>))
<a name="l00492"></a>00492 
<a name="l00493"></a>00493    <a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a> = JMAT_eff(1:<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+1:<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)
<a name="l00494"></a>00494    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00495"></a>00495       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00496"></a>00496          <a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j) = JMAT_eff(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+i,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+j)
<a name="l00497"></a>00497       <span class="keyword">end do</span>
<a name="l00498"></a>00498    <span class="keyword">end do</span>
<a name="l00499"></a>00499 
<a name="l00500"></a>00500    <span class="keyword">write</span>(*,*) <span class="stringliteral">"holes A-&gt;B:"</span>, JMAT_eff(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)
<a name="l00501"></a>00501    <span class="keyword">write</span>(*,*) <span class="stringliteral">"holes B-&gt;A:"</span>, JMAT_eff(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>,<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>)
<a name="l00502"></a>00502    <span class="keyword">write</span>(*,*) <span class="stringliteral">"elecs A-&gt;B:"</span>, JMAT_eff(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+1,<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+1)
<a name="l00503"></a>00503    <span class="keyword">write</span>(*,*) <span class="stringliteral">"elecs B-&gt;A:"</span>, JMAT_eff(<a class="code" href="namespaceorbitals.html#ccdbee54c185f80bc96c4b445f6f8122">n_dim_A</a>+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>+1,<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>+1)
<a name="l00504"></a>00504 
<a name="l00505"></a>00505    <span class="comment">! Degenercay runs </span>
<a name="l00506"></a>00506    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>),<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)) 
<a name="l00507"></a>00507    <span class="keyword">allocate</span>(<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>),<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>)) 
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    sum = 0.0d0
<a name="l00510"></a>00510    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00511"></a>00511       <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)=exp((<a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>(i)-<a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>(1))/0.0256d0)
<a name="l00512"></a>00512       sum = sum + <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)
<a name="l00513"></a>00513    <span class="keyword">end do</span>
<a name="l00514"></a>00514    <a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>=<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>/sqrt(sum)
<a name="l00515"></a>00515 
<a name="l00516"></a>00516    sum = 0.0d0
<a name="l00517"></a>00517    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00518"></a>00518       <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)=exp((<a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>(i)-<a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>(1))/0.0256d0)
<a name="l00519"></a>00519       sum = sum + <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)*<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(i)
<a name="l00520"></a>00520    <span class="keyword">end do</span>
<a name="l00521"></a>00521    <a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>=<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>/sqrt(sum)
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    sum = 0.0d0
<a name="l00525"></a>00525    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00526"></a>00526       <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)=exp(-(<a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>(i+<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>)-<a class="code" href="namespaceorbitals.html#b6679c4ae8983cf10afb22f3b40ffe80">QPE_molA</a>(1+<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>))/0.0256d0)
<a name="l00527"></a>00527       sum = sum + <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)
<a name="l00528"></a>00528    <span class="keyword">end do</span>
<a name="l00529"></a>00529    <a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>=<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>/sqrt(sum)
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    sum = 0.0d0
<a name="l00532"></a>00532    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00533"></a>00533       <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)=exp(-(<a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>(i+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)-<a class="code" href="namespaceorbitals.html#5bca11c0a2a8ca111fcd84273835154a">QPE_molB</a>(1+<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>))/0.0256d0)
<a name="l00534"></a>00534       sum = sum + <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)*<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(i)
<a name="l00535"></a>00535    <span class="keyword">end do</span>
<a name="l00536"></a>00536    <a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>=<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>/sqrt(sum)
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = 0.0d0
<a name="l00540"></a>00540    <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> = 0.0d0
<a name="l00541"></a>00541    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>
<a name="l00542"></a>00542       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>
<a name="l00543"></a>00543          <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> + <a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j)**2.0d0
<a name="l00544"></a>00544          <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> = <a class="code" href="namespaceorbitals.html#efe05d8b00aacd977c8ecea2664fb97a">J_sq_boltz_h</a> + (<a class="code" href="namespaceorbitals.html#08be8cb30e351f1cb2fd796cface2832">homoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#2ac25d08c17ad9bdd89e4531a231c63a">J_hole</a>(i,j)*<a class="code" href="namespaceorbitals.html#75cb19071aa655c73237f89f61f6a05d">homoBboltz</a>(j))**2.0d0
<a name="l00545"></a>00545       <span class="keyword">end do</span>
<a name="l00546"></a>00546    <span class="keyword">end do</span>
<a name="l00547"></a>00547    <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a> = <a class="code" href="namespaceorbitals.html#074ee45b70c17d562e428ec9dd520f26">J_sq_degen_h</a>/dble(<a class="code" href="namespaceorbitals.html#7150ba7f35f7e70ffdb67a8846fa551c">homoAsub</a>*<a class="code" href="namespaceorbitals.html#0850272db3b2bb4a6a18b29f99661d63">homoBsub</a>)
<a name="l00548"></a>00548 
<a name="l00549"></a>00549    <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = 0.0d0
<a name="l00550"></a>00550    <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> = 0.0d0
<a name="l00551"></a>00551    <span class="keyword">do</span> i = 1, <a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>
<a name="l00552"></a>00552       <span class="keyword">do</span> j = 1, <a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>
<a name="l00553"></a>00553          <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> + <a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j)**2.0d0
<a name="l00554"></a>00554          <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> = <a class="code" href="namespaceorbitals.html#445350d7ff5e7adda0e22e31b91f32b4">J_sq_boltz_e</a> + (<a class="code" href="namespaceorbitals.html#756636c9da1a023d94fa45a3f7b76972">lumoAboltz</a>(i)*<a class="code" href="namespaceorbitals.html#edca385e70cc6e1d47436e09563d553e">J_elec</a>(i,j)*<a class="code" href="namespaceorbitals.html#ac9976c883ed204878c76ac85c2f1f01">lumoBboltz</a>(j))**2.0d0
<a name="l00555"></a>00555       <span class="keyword">end do</span>
<a name="l00556"></a>00556    <span class="keyword">end do</span>
<a name="l00557"></a>00557    <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a> = <a class="code" href="namespaceorbitals.html#19932317c832cb1a6ccaff18a111e380">J_sq_degen_e</a>/dble(<a class="code" href="namespaceorbitals.html#c76482a112643921a4a8d966e1072bee">lumoAsub</a>*<a class="code" href="namespaceorbitals.html#97e6d837c250e1fdc2bdc2f72c210f23">lumoBsub</a>)
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 
<a name="l00560"></a>00560    call <a class="code" href="output_8f90.html#d796672c6d4f91f9fdc24fd5eef86043">XMLoutput</a>
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="keyword">end if</span>
<a name="l00564"></a>00564 <span class="keyword">END PROGRAM DIPRO_TI</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
