<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Votca: ctp/src/libctp/calculators/eoutersphere.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ctp/src/libctp/calculators/eoutersphere.cc</h1><a href="eoutersphere_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright 2009-2011 The VOTCA Development Team (http://www.votca.org)</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Licensed under the Apache License, Version 2.0 (the "License");</span>
<a name="l00005"></a>00005 <span class="comment"> * you may not use this file except in compliance with the License.</span>
<a name="l00006"></a>00006 <span class="comment"> * You may obtain a copy of the License at</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * Unless required by applicable law or agreed to in writing, software</span>
<a name="l00011"></a>00011 <span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span>
<a name="l00012"></a>00012 <span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00013"></a>00013 <span class="comment"> * See the License for the specific language governing permissions and</span>
<a name="l00014"></a>00014 <span class="comment"> * limitations under the License.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="eoutersphere_8h.html">eoutersphere.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;boost/lexical_cast.hpp&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">namespace </span>votca { <span class="keyword">namespace </span>ctp {
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#42431b8f53c6f9a82a8fccbccc6462e9">00028</a> <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#42431b8f53c6f9a82a8fccbccc6462e9">Eoutersphere::Initialize</a>(<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html" title="topology of conjugated segments and rigid fragments">QMTopology</a> *top, <a class="code" href="classvotca_1_1tools_1_1Property.html" title="class to manage properties and options, also used as an xml-wrapper">Property</a> *<a class="code" href="namespacedensity__symmetrize.html#b03e9a2229b129b862f9b831e961b35e">options</a>) {
<a name="l00029"></a>00029     <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#641e195ac9d2e74b1a5e571e4915512c">_options</a> = options;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031     <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"options.eoutersphere.method"</span>)) {
<a name="l00032"></a>00032        <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.method"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span> &gt; () == <span class="stringliteral">"constant"</span>) {
<a name="l00033"></a>00033         
<a name="l00034"></a>00034         <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"options.eoutersphere.lambdconst"</span>)) {
<a name="l00035"></a>00035             cout &lt;&lt; <span class="stringliteral">"Thank you for choosing the constant lambda method"</span>&lt;&lt;endl;
<a name="l00036"></a>00036             <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#7ecf3b9657a5887772b66e88f245fe61">_lambda_const</a> = options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.lambdaconst"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt;();
<a name="l00037"></a>00037             cout &lt;&lt; <span class="stringliteral">"Using a constant lambda outer of "</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#7ecf3b9657a5887772b66e88f245fe61">_lambda_const</a> &lt;&lt; endl;
<a name="l00038"></a>00038         } <span class="keywordflow">else</span> {
<a name="l00039"></a>00039             <span class="comment">//_lambda_const = 0.0;</span>
<a name="l00040"></a>00040             <span class="comment">//cout &lt;&lt; "Warning: no lambdaconst defined in options file, using outer sphere lambda = 0." &lt;&lt; endl;</span>
<a name="l00041"></a>00041            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"Error in eoutersphere: method lambdaconst was chosen but no lambdaconst provided"</span>);
<a name="l00042"></a>00042         }
<a name="l00043"></a>00043     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.method"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span> &gt; () == <span class="stringliteral">"spheres"</span>) {
<a name="l00044"></a>00044         <span class="comment">//_method = &amp;CalcLambdaOut::spheres_lambda;</span>
<a name="l00045"></a>00045         cout &lt;&lt; <span class="stringliteral">"Thank you for choosing the spheres lambda method"</span>&lt;&lt;endl;
<a name="l00046"></a>00046         <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"options.eoutersphere.pekar"</span>)) {
<a name="l00047"></a>00047             <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#20bee07dee63d546007a3eb6970c07f4">_pekar</a> = options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.pekar"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt;();
<a name="l00048"></a>00048             cout &lt;&lt; <span class="stringliteral">"Using a Pekar factor of "</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#20bee07dee63d546007a3eb6970c07f4">_pekar</a> &lt;&lt; endl;
<a name="l00049"></a>00049         } <span class="keywordflow">else</span> {
<a name="l00050"></a>00050             <span class="comment">//_pekar = 0.05;</span>
<a name="l00051"></a>00051             <span class="comment">//cout &lt;&lt; "Warning: no Pekar factor defined, using pekar =0.05" &lt;&lt; endl;</span>
<a name="l00052"></a>00052           <span class="keywordflow">throw</span>  std::runtime_error(<span class="stringliteral">"Error in eoutersphere: no Pekar factor provided"</span>);
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054         <span class="comment">//if (options-&gt;exists("options.eoutersphere.cutoff")) {</span>
<a name="l00055"></a>00055         <span class="comment">//    _lambda_cutoff = options-&gt;get("options.eoutersphere.cutoff").as&lt;double&gt;();</span>
<a name="l00056"></a>00056         <span class="comment">//    cout &lt;&lt; "Using a cutoff for lambda outer sphere of " &lt;&lt; _lambda_cutoff &lt;&lt; endl;</span>
<a name="l00057"></a>00057         <span class="comment">//} else {</span>
<a name="l00058"></a>00058             <span class="comment">//_lambda_cutoff = 50;</span>
<a name="l00059"></a>00059             <span class="comment">//cout &lt;&lt; "Warning: no cutoff defined, using 50nm" &lt;&lt; endl;</span>
<a name="l00060"></a>00060         <span class="comment">//    std::runtime_error("Error in eoutersphere: no cutoff for interactions defined");</span>
<a name="l00061"></a>00061        <span class="comment">// }</span>
<a name="l00062"></a>00062       }
<a name="l00063"></a>00063     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.method"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span> &gt; () == <span class="stringliteral">"dielectric"</span>) {
<a name="l00064"></a>00064         <span class="comment">//_method = &amp;CalcLambdaOut::dielectric_lambda;</span>
<a name="l00065"></a>00065         cout &lt;&lt; <span class="stringliteral">"Thank you for choosing dielectric lambda method"</span>&lt;&lt;endl;
<a name="l00066"></a>00066         <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"options.eoutersphere.pekar"</span>)) {
<a name="l00067"></a>00067             <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#20bee07dee63d546007a3eb6970c07f4">_pekar</a> = options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.pekar"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt;();
<a name="l00068"></a>00068             cout &lt;&lt; <span class="stringliteral">"Using a Pekar factor of "</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#20bee07dee63d546007a3eb6970c07f4">_pekar</a> &lt;&lt; endl;
<a name="l00069"></a>00069         } <span class="keywordflow">else</span> {
<a name="l00070"></a>00070             <span class="comment">//_pekar = 0.05;</span>
<a name="l00071"></a>00071             <span class="comment">//cout &lt;&lt; "Warning: no Pekar factor defined, using pekar =0.05" &lt;&lt; endl;</span>
<a name="l00072"></a>00072            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"Error in eoutersphere: no Pekar factor provided"</span>);
<a name="l00073"></a>00073         }
<a name="l00074"></a>00074         <span class="keywordflow">if</span> (options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#d6571e16bf9253f6036b000e15449c79" title="check weather property exists">exists</a>(<span class="stringliteral">"options.eoutersphere.cutoff"</span>)) {
<a name="l00075"></a>00075             <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#b317f78458700a0714e0686f5b31e098">_lambda_cutoff</a> = options-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.cutoff"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt;();
<a name="l00076"></a>00076             cout &lt;&lt; <span class="stringliteral">"Using a cutoff for lambda outer sphere of "</span> &lt;&lt; <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#b317f78458700a0714e0686f5b31e098">_lambda_cutoff</a> &lt;&lt; endl;
<a name="l00077"></a>00077         } <span class="keywordflow">else</span> {
<a name="l00078"></a>00078             <span class="comment">//_lambda_cutoff = 50;</span>
<a name="l00079"></a>00079             <span class="comment">//cout &lt;&lt; "Warning: no cutoff defined, using 50nm" &lt;&lt; endl;</span>
<a name="l00080"></a>00080           <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"Error in eoutersphere: no cutoff for interactions defined"</span>);
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082     } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"Error in CalcLambdaOut::Initialize : no such lambda method, should be constant, spheres or dielectric"</span>);
<a name="l00083"></a>00083     } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"Error in CalcLambdaOut::Initialize : no lambda method specified, should be constant, spheres or dielectric"</span>);
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#1aa2716c3abcfbf36c3e2eee5d9de974">00086</a> <span class="keywordtype">bool</span> <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#1aa2716c3abcfbf36c3e2eee5d9de974">Eoutersphere::EvaluateFrame</a>(<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html" title="topology of conjugated segments and rigid fragments">QMTopology</a> *top) {
<a name="l00087"></a>00087         <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#641e195ac9d2e74b1a5e571e4915512c">_options</a>-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.method"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span> &gt; () == <span class="stringliteral">"constant"</span>) {
<a name="l00088"></a>00088             <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#d931092a4cc0801fedc9f764570afb71" title="constant epsilon">const_lambda</a>(top);
<a name="l00089"></a>00089            }
<a name="l00090"></a>00090         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#641e195ac9d2e74b1a5e571e4915512c">_options</a>-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.method"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span> &gt; () == <span class="stringliteral">"spheres"</span>) {
<a name="l00091"></a>00091            <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#2f2076e54f63e0a8f792cde02ce3ffd5">spheres_lambda</a>(top);
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#641e195ac9d2e74b1a5e571e4915512c">_options</a>-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"options.eoutersphere.method"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">string</span> &gt; () == <span class="stringliteral">"dielectric"</span>) {
<a name="l00094"></a>00094            <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#8e4b806beb820f67300c440955f7d34e">dielectric_lambda</a>(top);
<a name="l00095"></a>00095        }
<a name="l00096"></a>00096     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#d931092a4cc0801fedc9f764570afb71">00100</a>     <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#d931092a4cc0801fedc9f764570afb71" title="constant epsilon">Eoutersphere::const_lambda</a>(<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html" title="topology of conjugated segments and rigid fragments">QMTopology</a> *top) {
<a name="l00101"></a>00101         <a class="code" href="classvotca_1_1ctp_1_1QMNBList.html" title="Neighbour search for crg units.">QMNBList</a>&amp; nblist=top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#9954235c93306613aac45eedae6e8b22" title="QM neighbor list [nm].">nblist</a>();
<a name="l00102"></a>00102         <span class="keywordflow">for</span> (<a class="code" href="classvotca_1_1csg_1_1PairList.html#8341cf06ea420f03dcb5160119278a8a">QMNBList::iterator</a> ipair = nblist.<a class="code" href="classvotca_1_1csg_1_1PairList.html#777aae1be02460855d63db209b7e7cbd">begin</a>(); ipair != nblist.<a class="code" href="classvotca_1_1csg_1_1PairList.html#0ce372735a6cd3bacbe3cc9402d795a5">end</a>(); ++ipair) {
<a name="l00103"></a>00103         <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair = *ipair;
<a name="l00104"></a>00104         <a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a> *crg1 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ed6d5ec1f32c2496c013aed494a84d07" title="first crg unit (might be ghost copy for pbc image)">Crg1PBCCopy</a>();
<a name="l00105"></a>00105         <a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a> *crg2 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#f7e0347da6e31acc1e83e60f9c70f4dc" title="second crg unit (might be ghost copy for pbc image)">Crg2PBCCopy</a>();
<a name="l00106"></a>00106         <span class="keywordtype">double</span> lambda = <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#7ecf3b9657a5887772b66e88f245fe61">_lambda_const</a>;
<a name="l00107"></a>00107         pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1CustomFields.html#76bcb254276863d1781eb56a331eac63">setDouble</a>(<span class="stringliteral">"lambda_outer"</span>,lambda);
<a name="l00108"></a>00108         cout &lt;&lt; <span class="stringliteral">"lambda out [eV] for pair "</span> &lt;&lt; crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() &lt;&lt; <span class="stringliteral">" and "</span> &lt;&lt; crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() &lt;&lt; <span class="stringliteral">" is "</span> &lt;&lt; lambda &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00109"></a>00109    }
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#2f2076e54f63e0a8f792cde02ce3ffd5">00112</a>     <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#2f2076e54f63e0a8f792cde02ce3ffd5">Eoutersphere::spheres_lambda</a>(<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html" title="topology of conjugated segments and rigid fragments">QMTopology</a> *top) {
<a name="l00113"></a>00113         <a class="code" href="classvotca_1_1ctp_1_1QMNBList.html" title="Neighbour search for crg units.">QMNBList</a>&amp; nblist=top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#9954235c93306613aac45eedae6e8b22" title="QM neighbor list [nm].">nblist</a>();
<a name="l00114"></a>00114         <span class="keywordflow">for</span> (<a class="code" href="classvotca_1_1csg_1_1PairList.html#8341cf06ea420f03dcb5160119278a8a">QMNBList::iterator</a> ipair = nblist.<a class="code" href="classvotca_1_1csg_1_1PairList.html#777aae1be02460855d63db209b7e7cbd">begin</a>(); ipair != nblist.<a class="code" href="classvotca_1_1csg_1_1PairList.html#0ce372735a6cd3bacbe3cc9402d795a5">end</a>(); ++ipair) {
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair = *ipair;
<a name="l00117"></a>00117         <a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a> *crg1 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ed6d5ec1f32c2496c013aed494a84d07" title="first crg unit (might be ghost copy for pbc image)">Crg1PBCCopy</a>();
<a name="l00118"></a>00118         <a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a> *crg2 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#f7e0347da6e31acc1e83e60f9c70f4dc" title="second crg unit (might be ghost copy for pbc image)">Crg2PBCCopy</a>();
<a name="l00119"></a>00119             <span class="keywordtype">double</span> R_one = crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#c3f7ae00340c43ac55e674c480fceb1b" title="get the type of the crg unit">getType</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#9addf23a25aef75d8030eb8352069e86">getOptions</a>()-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"R_lambda"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt;();
<a name="l00120"></a>00120             <span class="keywordtype">double</span> R_two = crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#c3f7ae00340c43ac55e674c480fceb1b" title="get the type of the crg unit">getType</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#9addf23a25aef75d8030eb8352069e86">getOptions</a>()-&gt;<a class="code" href="classvotca_1_1tools_1_1Property.html#3d205067df14b752467239235e0d1895" title="get existing property">get</a>(<span class="stringliteral">"R_lambda"</span>).<a class="code" href="classvotca_1_1tools_1_1Property.html#c1da3461d4a03628ab0a1f416591822d" title="return value as type">as</a>&lt;<span class="keywordtype">double</span>&gt;();
<a name="l00121"></a>00121 
<a name="l00122"></a>00122             <span class="keywordtype">double</span> distance = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#be4cef08ecd12002753fdb56e75b9a48" title="the distance of the beads">dist</a>();
<a name="l00123"></a>00123             <span class="keywordtype">double</span> <a class="code" href="namespacemerge__orbitals.html#e5c7ec430fc7dca1f672e4dd33309008">e</a> = 1.602176487e-19;
<a name="l00124"></a>00124             <span class="keywordtype">double</span> epsilon_zero = 8.85418782e-12;
<a name="l00125"></a>00125             <span class="keywordtype">double</span> nanometer = 1.0e-09;
<a name="l00126"></a>00126             <span class="keywordtype">double</span> lambda = <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#20bee07dee63d546007a3eb6970c07f4">_pekar</a> * e / (4.0 * M_PI * epsilon_zero)*(1.0 / (2.0 * R_one * nanometer) + 1.0 / (2.0 * R_two * nanometer) - 1.0 / (distance * nanometer));
<a name="l00127"></a>00127         pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1CustomFields.html#76bcb254276863d1781eb56a331eac63">setDouble</a>(<span class="stringliteral">"lambda_outer"</span>,lambda);
<a name="l00128"></a>00128         cout &lt;&lt; <span class="stringliteral">"lambda out [eV] for pair "</span> &lt;&lt; crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() &lt;&lt; <span class="stringliteral">" and "</span> &lt;&lt; crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() &lt;&lt; <span class="stringliteral">" at distance "</span>&lt;&lt; distance &lt;&lt; <span class="stringliteral">" is "</span> &lt;&lt; lambda &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130      }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#8e4b806beb820f67300c440955f7d34e">00132</a>     <span class="keywordtype">void</span> <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#8e4b806beb820f67300c440955f7d34e">Eoutersphere::dielectric_lambda</a>(<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html" title="topology of conjugated segments and rigid fragments">QMTopology</a> *top) {
<a name="l00133"></a>00133         <a class="code" href="classvotca_1_1ctp_1_1QMNBList.html" title="Neighbour search for crg units.">QMNBList</a>&amp; nblist=top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#9954235c93306613aac45eedae6e8b22" title="QM neighbor list [nm].">nblist</a>();
<a name="l00134"></a>00134         <span class="keywordflow">for</span> (<a class="code" href="classvotca_1_1csg_1_1PairList.html#8341cf06ea420f03dcb5160119278a8a">QMNBList::iterator</a> ipair = nblist.<a class="code" href="classvotca_1_1csg_1_1PairList.html#777aae1be02460855d63db209b7e7cbd">begin</a>(); ipair != nblist.<a class="code" href="classvotca_1_1csg_1_1PairList.html#0ce372735a6cd3bacbe3cc9402d795a5">end</a>(); ++ipair) {
<a name="l00135"></a>00135         <a class="code" href="classvotca_1_1ctp_1_1QMPair.html">QMPair</a> *pair = *ipair;
<a name="l00136"></a>00136         <span class="keywordtype">double</span> distance = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#be4cef08ecd12002753fdb56e75b9a48" title="the distance of the beads">dist</a>();
<a name="l00137"></a>00137         <a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a> *crg1 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#ed6d5ec1f32c2496c013aed494a84d07" title="first crg unit (might be ghost copy for pbc image)">Crg1PBCCopy</a>();
<a name="l00138"></a>00138         <a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a> *crg2 = pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMPair.html#f7e0347da6e31acc1e83e60f9c70f4dc" title="second crg unit (might be ghost copy for pbc image)">Crg2PBCCopy</a>();
<a name="l00139"></a>00139         <span class="keywordtype">double</span> lambda = 0.0;
<a name="l00140"></a>00140            
<a name="l00141"></a>00141             vector&lt;QMCrgUnit *&gt; lcharges = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#f7e0ce286388e432f20a8680b2bc1f03" title="List of charge units [Bohr].">CrgUnits</a>();
<a name="l00142"></a>00142             <a class="code" href="classvotca_1_1csg_1_1Topology.html" title="topology of the whole system">Topology</a> atop;
<a name="l00143"></a>00143             atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#f8a379ac2984eaedfd1b6a9d3f6f6a47">setBox</a>(top-&gt;<a class="code" href="classvotca_1_1csg_1_1Topology.html#17c77ff03972cf2744dbf308636f30cf">getBox</a>());
<a name="l00144"></a>00144             <span class="comment">//Add the beads of charge units i and j to the atop</span>
<a name="l00145"></a>00145             <a class="code" href="classvotca_1_1csg_1_1Molecule.html" title="information about molecules">Molecule</a> *molcrg1 = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#b3eebb2c363adc9462982eb766a55bee" title="Loads the atomistic beads (from mol_and_orb) into totop from the CrgUnit defined...">AddAtomisticBeads</a>(crg1, &amp;atop);
<a name="l00146"></a>00146             <a class="code" href="classvotca_1_1csg_1_1Molecule.html" title="information about molecules">Molecule</a> *molcrg2 = top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#b3eebb2c363adc9462982eb766a55bee" title="Loads the atomistic beads (from mol_and_orb) into totop from the CrgUnit defined...">AddAtomisticBeads</a>(crg2, &amp;atop);
<a name="l00147"></a>00147             <span class="comment">//Add the rest of the beads to atop</span>
<a name="l00148"></a>00148             <span class="keywordflow">for</span> (vector&lt;QMCrgUnit *&gt;::iterator itl = lcharges.begin(); itl != lcharges.end(); itl++) {
<a name="l00149"></a>00149                 <span class="keywordflow">if</span> (crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() == (*itl)-&gt;getId()) <span class="keywordflow">continue</span>;
<a name="l00150"></a>00150                 <span class="keywordflow">if</span> (crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() == (*itl)-&gt;getId()) <span class="keywordflow">continue</span>;
<a name="l00151"></a>00151                 top-&gt;<a class="code" href="classvotca_1_1ctp_1_1QMTopology.html#b3eebb2c363adc9462982eb766a55bee" title="Loads the atomistic beads (from mol_and_orb) into totop from the CrgUnit defined...">AddAtomisticBeads</a>(*itl, &amp;atop);
<a name="l00152"></a>00152             }
<a name="l00153"></a>00153            <span class="comment">//Loop over all beads exterior to crgunits i and j</span>
<a name="l00154"></a>00154             
<a name="l00155"></a>00155             <span class="keywordflow">for</span> (BeadContainer::iterator ibead = atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#fa2f13a8800309329a994a181ee6ad28">Beads</a>().begin(); ibead != atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#fa2f13a8800309329a994a181ee6ad28">Beads</a>().end(); ++ibead) {
<a name="l00156"></a>00156                 <a class="code" href="classvotca_1_1csg_1_1Bead.html" title="information about a bead">Bead</a> *bk = *ibead;
<a name="l00157"></a>00157                                 
<a name="l00158"></a>00158                 <span class="keywordflow">if</span> (bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a>&gt;()-&gt;getId() == crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>()) <span class="keywordflow">continue</span>;
<a name="l00159"></a>00159                 <span class="keywordflow">if</span> (bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a>&gt;()-&gt;getId() == crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>()) <span class="keywordflow">continue</span>;
<a name="l00160"></a>00160                 <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> bc = atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#d583d2b7da415e7f1f217560fb63fc2b" title="calculate shortest vector connecting two points">BCShortestConnection</a>(bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html" title="information about a CrgUnit">CrgUnit</a> &gt; ()-&gt;GetCom(), crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#6ad77e6067712e3f59a2c4ed48e33471">GetCom</a>());
<a name="l00161"></a>00161                 <span class="keywordflow">if</span> ( <a class="code" href="namespacevotca_1_1tools.html#bc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(bc)&gt; <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#b317f78458700a0714e0686f5b31e098">_lambda_cutoff</a>) <span class="keywordflow">continue</span>;
<a name="l00162"></a>00162                 bc = atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#d583d2b7da415e7f1f217560fb63fc2b" title="calculate shortest vector connecting two points">BCShortestConnection</a>(bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html" title="information about a CrgUnit">CrgUnit</a> &gt; ()-&gt;GetCom(), crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#6ad77e6067712e3f59a2c4ed48e33471">GetCom</a>());
<a name="l00163"></a>00163                 <span class="keywordflow">if</span> ( <a class="code" href="namespacevotca_1_1tools.html#bc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(bc)&gt; <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#b317f78458700a0714e0686f5b31e098">_lambda_cutoff</a>) <span class="keywordflow">continue</span>;
<a name="l00164"></a>00164                 <span class="comment">//cout &lt;&lt; "chosen bead number:" &lt;&lt; bk-&gt;getMolecule()-&gt;getUserData&lt;QMCrgUnit&gt;()-&gt;getId() &lt;&lt; endl;</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166                 <span class="keywordtype">double</span> Dx = 0.0;
<a name="l00167"></a>00167                 <span class="keywordtype">double</span> Dy = 0.0;
<a name="l00168"></a>00168                 <span class="keywordtype">double</span> Dz = 0.0;
<a name="l00169"></a>00169                 <span class="keywordtype">double</span> nanometer = 1.0e-09;
<a name="l00170"></a>00170                 <span class="keywordtype">double</span> nanometer3 = 1.0e-27;
<a name="l00171"></a>00171                 <span class="keywordtype">double</span> elementary_charge = 1.60217646e-19;
<a name="l00172"></a>00172                 <span class="keywordtype">double</span> epsilon_zero = 8.85418782e-12;
<a name="l00173"></a>00173                 <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> bcs, <a class="code" href="namespacedata__compare.html#8a59a2fef8bdf0b929e4fa284a2eae33">diff</a> , dist;
<a name="l00174"></a>00174                 <span class="comment">//Get shortest distance to crgunit i TOP OR ATOP???</span>
<a name="l00175"></a>00175                 <span class="comment">//diff = top-&gt;BCShortestConnection(crg1-&gt;GetCom(), bk-&gt;getMolecule()-&gt;getUserData&lt;QMCrgUnit&gt;()-&gt;GetCom());</span>
<a name="l00176"></a>00176                  bcs = atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#d583d2b7da415e7f1f217560fb63fc2b" title="calculate shortest vector connecting two points">BCShortestConnection</a>(bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a>&gt;()-&gt;GetCom(),crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#6ad77e6067712e3f59a2c4ed48e33471">GetCom</a>());
<a name="l00177"></a>00177                  dist = crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#6ad77e6067712e3f59a2c4ed48e33471">GetCom</a>()- bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a>&gt;()-&gt;GetCom() ;
<a name="l00178"></a>00178                  diff = bcs - dist;
<a name="l00179"></a>00179                 <span class="comment">//Loop over all bead of crgunit i</span>
<a name="l00180"></a>00180                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bi = 0; bi &lt; molcrg1-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#2ae32e4dc7124badb92a291018437915" title="get the number of beads in the molecule">BeadCount</a>(); ++bi) {
<a name="l00181"></a>00181                     <a class="code" href="classvotca_1_1csg_1_1Bead.html" title="information about a bead">Bead</a> *beadi = molcrg1-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#b2245f939b0680f85aeacf81ceb97fdb" title="get the id of a bead in the molecule">getBead</a>(bi);
<a name="l00182"></a>00182                     <span class="comment">//Compute deltaQ</span>
<a name="l00183"></a>00183                     <span class="keywordtype">double</span> charge_of_bead_i_charged = crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#c3f7ae00340c43ac55e674c480fceb1b" title="get the type of the crg unit">getType</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c11ca1117d6d01d8c5fcd2d90597d4e4">GetCrgUnit</a>().<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#c1f3f6fd5c64dfdac174043f6f902e91">getChargesCrged</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1multipoles.html#0dfe3a4fc047505b3d83758f0e50e87a">mpls</a>[bi];
<a name="l00184"></a>00184                     <span class="keywordtype">double</span> charge_of_bead_i_neutral = crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#c3f7ae00340c43ac55e674c480fceb1b" title="get the type of the crg unit">getType</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c11ca1117d6d01d8c5fcd2d90597d4e4">GetCrgUnit</a>().<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8d8d6e8c144018d1a622117196ebe510">getChargesNeutr</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1multipoles.html#0dfe3a4fc047505b3d83758f0e50e87a">mpls</a>[bi];
<a name="l00185"></a>00185                     <span class="keywordtype">double</span> delta_Q = charge_of_bead_i_charged - charge_of_bead_i_neutral;
<a name="l00186"></a>00186                     <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> r_v = bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#feb069f0e094fc7b4e1da07efe9751ce">getPos</a>()-(beadi-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#feb069f0e094fc7b4e1da07efe9751ce">getPos</a>() + diff);
<a name="l00187"></a>00187                     <span class="keywordtype">double</span> <a class="code" href="kmc__old_8cc.html#e243e7fff6a6d0eecd4adaa52b0fe8a2">r</a> = <a class="code" href="namespacevotca_1_1tools.html#bc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(r_v);
<a name="l00188"></a>00188                     <span class="keywordtype">double</span> r3 = r * r * r;
<a name="l00189"></a>00189                     <span class="comment">//cout &lt;&lt; "delta Q:" &lt;&lt; delta_Q &lt;&lt; "|r3: " &lt;&lt;r3 &lt;&lt; "|r_v.getX "&lt;&lt;r_v.getX()&lt;&lt;endl;</span>
<a name="l00190"></a>00190                     Dx = Dx + elementary_charge * delta_Q / (4.0 * M_PI * r3 * nanometer3) * r_v.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>() * nanometer;
<a name="l00191"></a>00191                     Dy = Dy + elementary_charge * delta_Q / (4.0 * M_PI * r3 * nanometer3) * r_v.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>() * nanometer;
<a name="l00192"></a>00192                     Dz = Dz + elementary_charge * delta_Q / (4.0 * M_PI * r3 * nanometer3) * r_v.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>() * nanometer;
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194                 <span class="comment">//cout &lt;&lt; "D due to mol i:"&lt;&lt;D&lt;&lt;endl;</span>
<a name="l00195"></a>00195                 <span class="comment">//Get shortest distance to crgunit j TOP OR ATOP???</span>
<a name="l00196"></a>00196                 <span class="comment">//diff = top-&gt;BCShortestConnection(crg2-&gt;GetCom(), bk-&gt;getMolecule()-&gt;getUserData&lt;QMCrgUnit&gt;()-&gt;GetCom());</span>
<a name="l00197"></a>00197                  
<a name="l00198"></a>00198                 bcs = atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#d583d2b7da415e7f1f217560fb63fc2b" title="calculate shortest vector connecting two points">BCShortestConnection</a>(bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a>&gt;()-&gt;GetCom(),crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#6ad77e6067712e3f59a2c4ed48e33471">GetCom</a>());
<a name="l00199"></a>00199                 dist =  crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#6ad77e6067712e3f59a2c4ed48e33471">GetCom</a>()-bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#ecdb3e0a1e71349b897c349090d49abd">getMolecule</a>()-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#4dbb0ea96819a9d4cd543d998013f7f5">getUserData</a>&lt;<a class="code" href="classvotca_1_1ctp_1_1QMCrgUnit.html">QMCrgUnit</a>&gt;()-&gt;GetCom();
<a name="l00200"></a>00200                 diff = bcs - dist;
<a name="l00201"></a>00201                 <span class="comment">//Loop over all bead of crgunit j</span>
<a name="l00202"></a>00202                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bj = 0; bj &lt; molcrg2-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#2ae32e4dc7124badb92a291018437915" title="get the number of beads in the molecule">BeadCount</a>(); ++bj) {
<a name="l00203"></a>00203                     <a class="code" href="classvotca_1_1csg_1_1Bead.html" title="information about a bead">Bead</a> *beadj = molcrg2-&gt;<a class="code" href="classvotca_1_1csg_1_1Molecule.html#b2245f939b0680f85aeacf81ceb97fdb" title="get the id of a bead in the molecule">getBead</a>(bj);
<a name="l00204"></a>00204                     <span class="comment">//Compute deltaQ</span>
<a name="l00205"></a>00205                     <span class="keywordtype">double</span> charge_of_bead_j_charged = crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#c3f7ae00340c43ac55e674c480fceb1b" title="get the type of the crg unit">getType</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c11ca1117d6d01d8c5fcd2d90597d4e4">GetCrgUnit</a>().<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#c1f3f6fd5c64dfdac174043f6f902e91">getChargesCrged</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1multipoles.html#0dfe3a4fc047505b3d83758f0e50e87a">mpls</a>[bj];
<a name="l00206"></a>00206                     <span class="keywordtype">double</span> charge_of_bead_j_neutral = crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#c3f7ae00340c43ac55e674c480fceb1b" title="get the type of the crg unit">getType</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnitType.html#c11ca1117d6d01d8c5fcd2d90597d4e4">GetCrgUnit</a>().<a class="code" href="classvotca_1_1moo_1_1mol__and__orb.html#8d8d6e8c144018d1a622117196ebe510">getChargesNeutr</a>()-&gt;<a class="code" href="classvotca_1_1moo_1_1multipoles.html#0dfe3a4fc047505b3d83758f0e50e87a">mpls</a>[bj];
<a name="l00207"></a>00207                     <span class="keywordtype">double</span> delta_Q = charge_of_bead_j_neutral - charge_of_bead_j_charged;
<a name="l00208"></a>00208                     <a class="code" href="classvotca_1_1tools_1_1vec.html" title="Vector class for a 3 component vector.">vec</a> r_v = bk-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#feb069f0e094fc7b4e1da07efe9751ce">getPos</a>()-(beadj-&gt;<a class="code" href="classvotca_1_1csg_1_1Bead.html#feb069f0e094fc7b4e1da07efe9751ce">getPos</a>() + diff);
<a name="l00209"></a>00209                     <span class="keywordtype">double</span> <a class="code" href="kmc__old_8cc.html#e243e7fff6a6d0eecd4adaa52b0fe8a2">r</a> = <a class="code" href="namespacevotca_1_1tools.html#bc0c90bbc5f6f5ad2695b3377f7e5684">abs</a>(r_v);
<a name="l00210"></a>00210                     <span class="keywordtype">double</span> r3 = r * r * r;
<a name="l00211"></a>00211                   <span class="comment">//  cout &lt;&lt; "delta Q:" &lt;&lt; delta_Q &lt;&lt; "|r3: " &lt;&lt;r3 &lt;&lt; "|r_v.getX "&lt;&lt;r_v.getX()&lt;&lt;endl;</span>
<a name="l00212"></a>00212                     Dx = Dx + elementary_charge * delta_Q / (4.0 * M_PI * r3 * nanometer3) * r_v.<a class="code" href="classvotca_1_1tools_1_1vec.html#b45304f25d8d52b149491a05b1c09a43" title="read only access to x element">getX</a>() * nanometer;
<a name="l00213"></a>00213                     Dy = Dy + elementary_charge * delta_Q / (4.0 * M_PI * r3 * nanometer3) * r_v.<a class="code" href="classvotca_1_1tools_1_1vec.html#272a8c6a3be544a2b9dd4b9f5960b02f" title="read only access to y element">getY</a>() * nanometer;
<a name="l00214"></a>00214                     Dz = Dz + elementary_charge * delta_Q / (4.0 * M_PI * r3 * nanometer3) * r_v.<a class="code" href="classvotca_1_1tools_1_1vec.html#cc1ceb986d70006789a06cf60169dea4" title="read only access to z element">getZ</a>() * nanometer;
<a name="l00215"></a>00215                 }
<a name="l00216"></a>00216                 <span class="comment">//cout &lt;&lt; "Dx :"&lt;&lt;Dx&lt;&lt;endl; cout &lt;&lt; "Dy :"&lt;&lt;Dy&lt;&lt;endl; cout &lt;&lt; "Dz :"&lt;&lt;Dz&lt;&lt;endl;</span>
<a name="l00217"></a>00217 
<a name="l00218"></a>00218                 <span class="comment">//cout &lt;&lt; "box volume:"&lt;&lt;atop.BoxVolume()&lt;&lt; " and beads:"&lt;&lt;atop.BeadCount()&lt;&lt;endl;</span>
<a name="l00219"></a>00219                 lambda = lambda + (Dx*Dx+Dy*Dy+Dz*Dz)  * <a class="code" href="classvotca_1_1ctp_1_1Eoutersphere.html#20bee07dee63d546007a3eb6970c07f4">_pekar</a> * atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#02e7f4b2f0160aacffbf902611dada4c">BoxVolume</a>()*nanometer3/atop.<a class="code" href="classvotca_1_1csg_1_1Topology.html#d6ffd4e005205905f4456940e58c6af8">BeadCount</a>()  * 1.0/(2.0 * epsilon_zero * elementary_charge);
<a name="l00220"></a>00220             }
<a name="l00221"></a>00221         pair-&gt;<a class="code" href="classvotca_1_1ctp_1_1CustomFields.html#76bcb254276863d1781eb56a331eac63">setDouble</a>(<span class="stringliteral">"lambda_outer"</span>,lambda);
<a name="l00222"></a>00222         cout &lt;&lt; <span class="stringliteral">"lambda out [eV] for pair "</span> &lt;&lt; crg1-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() &lt;&lt; <span class="stringliteral">" and "</span> &lt;&lt; crg2-&gt;<a class="code" href="classvotca_1_1moo_1_1CrgUnit.html#a4ae5ffc00959846ab5bf76ec3ad2632" title="get the ID of the charge unit">getId</a>() &lt;&lt;<span class="stringliteral">" at distance "</span>&lt;&lt; distance &lt;&lt; <span class="stringliteral">" is "</span> &lt;&lt; lambda &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00223"></a>00223        }
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 }}
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
